/**
 * PhysicsJS v0.7.0 - 2016-08-09
 * A modular, extendable, and easy-to-use physics engine for javascript
 * http://wellcaffeinated.net/PhysicsJS
 *
 * Copyright (c) 2016 Jasper Palfree <jasper@wellcaffeinated.net>
 * Licensed MIT
 */
!function(a,b){"object"==typeof exports?module.exports=b.call(a):"function"==typeof define&&define.amd?define(function(){return b.call(a)}):a.Physics=b.call(a)}("undefined"!=typeof window?window:this,function(){"use strict";var a=this,b=a.document,c=function f(){return f.world.apply(f,arguments)};c.util={},function(){c.aabb=function(a,b,c,d){var e={x:0,y:0,hw:0,hh:0};return void 0===a?e:(a&&void 0!==a.x&&(c=b.x,d=b.y,b=a.y,a=a.x),void 0===d&&void 0!==a&&void 0!==b?(e.hw=.5*a,e.hh=.5*b,c&&void 0!==c.x&&(e.x=c.x,e.y=c.y),e):(e.hw=.5*Math.abs(c-a),e.hh=.5*Math.abs(d-b),e.x=.5*(c+a),e.y=.5*(d+b),e))},c.aabb.contains=function(a,b){return b.x>a.x-a.hw&&b.x<a.x+a.hw&&b.y>a.y-a.hh&&b.y<a.y+a.hh},c.aabb.clone=function(a){return{x:a.x,y:a.y,hw:a.hw,hh:a.hh}},c.aabb.union=function(a,b,c){var d=c===!0?a:{},e=Math.max(a.x+a.hw,b.x+b.hw),f=Math.max(a.y+a.hh,b.y+b.hh),g=Math.min(a.x-a.hw,b.x-b.hw),h=Math.min(a.y-a.hh,b.y-b.hh);return d.hw=.5*Math.abs(e-g),d.hh=.5*Math.abs(f-h),d.x=.5*(e+g),d.y=.5*(f+h),d},c.aabb.overlap=function(a,b){var c=a.x-a.hw,d=b.x-b.hw,e=a.x+a.hw,f=b.x+b.hw;return(d<=e&&e<=f||c<=f&&f<=e)&&(c=a.y-a.hh,d=b.y-b.hh,e=a.y+a.hh,f=b.y+b.hh,d<=e&&e<=f||c<=f&&f<=e)}}(),function(){var a=1e-4,b=100,d=function(a,b,c){var d=b.normSq()-b.dot(a),e=b.dot(a)-a.normSq();return d<0?c.clone(b).negate():e>0?c.clone(a).negate():(c.clone(b).vsub(a),c.perp(a.cross(c)>0))},e=function(a){var b,d,e=a.length,f=a[e-2],g=a[e-3],h=c.scratchpad(),i=h.vector().clone(f.pt),j=h.vector().clone(g.pt).vsub(i);return j.equals(c.vector.zero)?h.done({a:f.a,b:f.b}):(b=-j.dot(i)/j.normSq(),d=1-b,d<=0?h.done({a:g.a,b:g.b}):b<=0?h.done({a:f.a,b:f.b}):h.done({a:i.clone(f.a).mult(d).vadd(j.clone(g.a).mult(b)).values(),b:i.clone(f.b).mult(d).vadd(j.clone(g.b).mult(b)).values()}))},f=function(f,g,h,i){var j,k,l,m,n=!1,o=!1,p=!1,q=[],r=1,s=c.scratchpad(),t=s.vector().clone(g||c.vector.axis[0]),u=s.vector(),v=s.vector(),w=s.vector(),x=s.vector(),y=0;for(m=f(t),r=q.push(m),u.clone(m.pt),t.negate();++y;){if(u.swap(v),m=f(t),r=q.push(m),u.clone(m.pt),i&&i(q),u.equals(c.vector.zero)){n=!0;break}if(!o&&u.dot(t)<=0){if(h)break;o=!0}if(2===r)t=d(u,v,t);else if(o){if(t.normalize(),m=v.dot(t),Math.abs(m-u.dot(t))<a){p=-m;break}v.normSq()<w.clone(q[0].pt).normSq()?q.shift():q.splice(1,1),t=d(w.clone(q[1].pt),x.clone(q[0].pt),t)}else if(j=j||s.vector(),k=k||s.vector(),j.clone(v).vsub(u),k.clone(q[0].pt).vsub(u),l=j.cross(k)>0,l^u.cross(j)>0)q.shift(),j.perp(!l),t.swap(j);else{if(!(l^k.cross(u)>0)){n=!0;break}q.splice(1,1),k.perp(l),t.swap(j)}if(y>b)return s.done(),{simplex:q,iterations:y,distance:0,maxIterationsReached:!0}}return s.done(),m={overlap:n,simplex:q,iterations:y},p!==!1&&(m.distance=p,m.closest=e(q)),m};c.gjk=f}(),function(){c.statistics={pushRunningAvg:function(a,b,c,d){var e=a-c;return c+=e/b,d+=e*(a-c),[c,d]},pushRunningVectorAvg:function(a,b,c,d){var e=1/b,f=a.get(0)-c.get(0),g=a.get(1)-c.get(1);c.add(f*e,g*e),d&&(f*=a.get(0)-c.get(0),g*=a.get(1)-c.get(1),d.add(f,g))}}}(),function(){var a=function b(a,d,e){return this instanceof b?(this.v=new c.vector,this.o=new c.vector,a instanceof b?void this.clone(a):(a&&this.setTranslation(a),void this.setRotation(d||0,e))):new b(a,d)};a.prototype.setTranslation=function(a){return this.v.clone(a),this},a.prototype.setRotation=function(a,b){return this.cosA=Math.cos(a),this.sinA=Math.sin(a),b?this.o.clone(b):this.o.zero(),this},a.prototype.clone=function(b){return b?(this.setTranslation(b.v),this.cosA=b.cosA,this.sinA=b.sinA,this.o.clone(b.o),this):new a(this)},c.transform=a}(),function(a){var b=Math.sqrt,d=Math.min,e=Math.max,f=(Math.acos,Math.atan2),g=2*Math.PI,h=!!a.Float64Array,i=function j(a,b){return this instanceof j?(h?this._=new Float64Array(5):this._=[],void(a&&(void 0!==a.x||a._&&a._.length)?this.clone(a):(this.recalc=!0,this.set(a,b)))):new j(a,b)};Object.defineProperties(i.prototype,{x:{get:function(){return+this._[0]},set:function(a){a=+a||0,this.recalc=a===this._[0],this._[0]=a}},y:{get:function(){return+this._[1]},set:function(a){a=+a||0,this.recalc=a===this._[1],this._[1]=a}}}),i.prototype.set=function(a,b){return this.recalc=!0,this._[0]=+a||0,this._[1]=+b||0,this},i.prototype.get=function(a){return this._[a]},i.prototype.vadd=function(a){return this.recalc=!0,this._[0]+=a._[0],this._[1]+=a._[1],this},i.prototype.vsub=function(a){return this.recalc=!0,this._[0]-=a._[0],this._[1]-=a._[1],this},i.prototype.add=function(a,b){return this.recalc=!0,this._[0]+=+a||0,this._[1]+=+b||0,this},i.prototype.sub=function(a,b){return this.recalc=!0,this._[0]-=a,this._[1]-=void 0===b?0:b,this},i.prototype.mult=function(a){return this.recalc||(this._[4]*=a*a,this._[3]*=a),this._[0]*=a,this._[1]*=a,this},i.prototype.dot=function(a){return this._[0]*a._[0]+this._[1]*a._[1]},i.prototype.cross=function(a){return-this._[0]*a._[1]+this._[1]*a._[0]},i.prototype.proj=function(a){return this.dot(a)/a.norm()},i.prototype.vproj=function(a){var b=this.dot(a)/a.normSq();return this.clone(a).mult(b)},i.prototype.angle=function(a){var b;if(this.equals(i.zero))return a?a.angle():NaN;for(b=a&&!a.equals(i.zero)?f(this._[1]*a._[0]-this._[0]*a._[1],this._[0]*a._[0]+this._[1]*a._[1]):f(this._[1],this._[0]);b>Math.PI;)b-=g;for(;b<-Math.PI;)b+=g;return b},i.prototype.angle2=function(a,b){for(var c=a._[0]-this._[0],d=a._[1]-this._[1],e=b._[0]-this._[0],h=b._[1]-this._[1],i=f(d*e-c*h,c*e+d*h);i>Math.PI;)i-=g;for(;i<-Math.PI;)i+=g;return i},i.prototype.norm=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=b(this._[4])),this._[3]},i.prototype.normSq=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=b(this._[4])),this._[4]},i.prototype.dist=function(a){var c,d;return b((c=a._[0]-this._[0])*c+(d=a._[1]-this._[1])*d)},i.prototype.distSq=function(a){var b,c;return(b=a._[0]-this._[0])*b+(c=a._[1]-this._[1])*c},i.prototype.perp=function(a){var b=this._[0];return a?(this._[0]=this._[1],this._[1]=-b):(this._[0]=-this._[1],this._[1]=b),this},i.prototype.normalize=function(){var a=this.norm();return 0===a?this:(a=1/a,this._[0]*=a,this._[1]*=a,this._[3]=1,this._[4]=1,this)},i.prototype.transform=function(a){var b=a.sinA,c=a.cosA,d=a.o._[0],e=a.o._[1];return this._[0]-=d,this._[1]-=e,this.set(this._[0]*c-this._[1]*b+d+a.v._[0],this._[0]*b+this._[1]*c+e+a.v._[1])},i.prototype.transformInv=function(a){var b=a.sinA,c=a.cosA,d=a.o._[0],e=a.o._[1];return this._[0]-=d+a.v._[0],this._[1]-=e+a.v._[1],this.set(this._[0]*c+this._[1]*b+d,-this._[0]*b+this._[1]*c+e)},i.prototype.rotate=function(a,b){var c,d,e=0,f=0;return"number"==typeof a?(c=Math.sin(a),d=Math.cos(a),b&&(e=b.x,f=b.y)):(c=a.sinA,d=a.cosA,e=a.o._[0],f=a.o._[1]),this._[0]-=e,this._[1]-=f,this.set(this._[0]*d-this._[1]*c+e,this._[0]*c+this._[1]*d+f)},i.prototype.rotateInv=function(a){return this.set((this._[0]-a.o._[0])*a.cosA+(this._[1]-a.o._[1])*a.sinA+a.o._[0],-(this._[0]-a.o._[0])*a.sinA+(this._[1]-a.o._[1])*a.cosA+a.o._[1])},i.prototype.translate=function(a){return this.vadd(a.v)},i.prototype.translateInv=function(a){return this.vsub(a.v)},i.prototype.clone=function(a){return a?a._?(this.recalc=a.recalc,a.recalc||(this._[3]=a._[3],this._[4]=a._[4]),this._[0]=a._[0],this._[1]=a._[1],this):this.set(a.x,a.y):new i(this)},i.prototype.swap=function(a){var b=this._;return this._=a._,a._=b,b=this.recalc,this.recalc=a.recalc,a.recalc=b,this},i.prototype.values=function(){return{x:this._[0],y:this._[1]}},i.prototype.zero=function(){return this._[3]=0,this._[4]=0,this._[0]=0,this._[1]=0,this},i.prototype.negate=function(a){return void 0!==a?(this._[a]=-this._[a],this):(this._[0]=-this._[0],this._[1]=-this._[1],this)},i.prototype.clamp=function(a,b){return this._[0]=d(e(this._[0],a.x),b.x),this._[1]=d(e(this._[1],a.y),b.y),this.recalc=!0,this},i.prototype.toString=function(){return"("+this._[0]+", "+this._[1]+")"},i.prototype.equals=function(a){return this._[0]===a._[0]&&this._[1]===a._[1]&&this._[2]===a._[2]},i.axis=[new i(1,0),new i(0,1)],i.zero=new i(0,0),c.vector=i}(this),function(a){var b=a.Physics;c.noConflict=function(){return a.Physics===c&&(a.Physics=b),c}}(this);var d=c.util.decorator=function(a,b){var d={},e={},f=function(a,b){var d,e;for(e in b)d=Object.getOwnPropertyDescriptor(b,e),d.get||d.set?Object.defineProperty(a,e,d):c.util.isFunction(d.value)&&(a[e]=d.value);return a},g=Object.getPrototypeOf;"function"!=typeof g&&(g="object"==typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var h=Object.create;"function"!=typeof h&&(h=function(a){function b(){}return b.prototype=a,new b});var i=function(b,d){return"object"==typeof b?(e=f(e,b),void(e.type=a)):void("type"!==b&&c.util.isFunction(d)&&(e[b]=d))};i(b);var j=function(b,c,i,j){var k,l=e;if("string"!=typeof c)j=i,i=c;else{if(l=d[c],!l)throw'Error: "'+c+'" '+a+" not defined";l=l.prototype}if("function"==typeof i)k=d[b],k?k.prototype=f(k.prototype,i(g(k.prototype))):(k=d[b]=function(a){this.init&&this.init(a)},k.prototype=h(l),k.prototype=f(k.prototype,i(l,k.prototype))),k.prototype.type=a,k.prototype.name=b;else if(j=i||{},k=d[b],!k)throw'Error: "'+b+'" '+a+" not defined";if(j)return new k(j)};return j.mixin=i,j};c.util.indexOf=function(a,b){for(var c=0,d=a.length;c<d;){if(d--,a[c]===b)return c;if(a[d]===b)return d;c++}return-1},c.util.clearArray=function(a){for(var b=a.length;b--;)a.pop();return a},c.util.throttle=function(a,b,c){var d,e,f=!1,g=function(){clearTimeout(d),f?(f=!1,d=setTimeout(g,b),a.apply(c,e)):d=!1};return c=c||null,function(){f=!0,e=arguments,d||g()}};var e=function(a,b){return c.util.isPlainObject(b)?c.util.extend({},a,b,e):void 0!==b?b:a};return c.util.options=function(a,b){var d,f={},g=[];return d=function(a,d){c.util.extend(b,a,d?e:null);for(var f=0,h=g.length;f<h;++f)g[f](b);return b},d.defaults=function(a,d){return c.util.extend(f,a,d?e:null),c.util.defaults(b,f,d?e:null),f},d.onChange=function(a){g.push(a)},b=b||d,d.defaults(a),d},c.util.pairHash=function(a,b){return a=0|a,b=0|b,(0|a)===(0|b)?-1:0|((0|a)>(0|b)?a<<16|65535&b:b<<16|65535&a)},Function.prototype.bind?c.util.bind=function(a,b,c){return c=Array.prototype.slice.call(arguments,1),Function.prototype.bind.apply(a,c)}:c.util.bind=function(a,b,c){return c=Array.prototype.slice.call(arguments,2),function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}},c.util.find=function(a,b){var c,d,e=a.length;for(c=0;c<e;c++)if(d=a[c],b(d,c,a))return d},c.util.filter=function(a,b){var c,d,e=a.length,f=[];for(c=0;c<e;c++)d=a[c],b(d,c,a)&&f.push(d);return f},function(){function a(a){c.util.clearArray(a),v.length<x&&v.push(a)}function b(a){var c=a.cache;c&&b(c),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,w.length<x&&w.push(a)}function d(){return w.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function e(){return v.pop()||[]}function f(a,b){var d=typeof b;if(a=a.cache,"boolean"===d||null==b)return a[b]?0:-1;"number"!==d&&"string"!==d&&(d="object");var e="number"===d?b:y+b;return a=(a=a[d])&&a[e],"object"===d?a&&c.util.indexOf(a,b)>-1?0:-1:a?0:-1}function g(a){var b=this.cache,c=typeof a;if("boolean"===c||null==a)b[a]=!0;else{"number"!==c&&"string"!==c&&(c="object");var d="number"===c?a:y+a,e=b[c]||(b[c]={});"object"===c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function h(a){var b=-1,c=a.length,e=a[0],f=a[c/2|0],h=a[c-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&h&&"object"==typeof h)return!1;var i=d();i["false"]=i["null"]=i["true"]=i.undefined=!1;var j=d();for(j.array=a,j.cache=i,j.push=g;++b<c;)j.push(a[b]);return j}function i(a,b){return a+Math.floor(Math.random()*(b-a+1))}function j(a){return"function"==typeof a}function k(a){return"function"==typeof a&&C.test(a)}function l(a){var b,c;if(!a||s.call(a)!==q||(b=a.constructor,j(b)&&!(b instanceof b)))return!1;for(var d in a)c=d;return"undefined"==typeof c||t.call(a,c)}function m(d,g,i){var j=-1,k=c.util.indexOf,l=d?d.length:0,m=[],n=!g&&l>=u&&k===c.util.indexOf,o=i||n?e():m;if(n){var p=h(o);k=f,o=p}for(;++j<l;){var q=d[j],r=i?i(q,j,d):q;(g?!j||o[o.length-1]!==r:k(o,r)<0)&&((i||n)&&o.push(r),m.push(q))}return n?(a(o.array),b(o)):i&&a(o),m}var n={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},o=function(a){return a},p="[object Array]",q="[object Object]",r=Object.keys,s=Object.prototype.toString,t=Object.prototype.hasOwnProperty,u=75,v=[],w=[],x=40,y=+new Date+"",z=function(a){var b,c=a,d=[];if(!c)return d;if(!n[typeof a])return d;for(b in c)t.call(c,b)&&d.push(b);return d},A=r?function(a){return c.util.isObject(a)?r(a):[]}:z,B=0;c.util.uniqueId=function(a){var b=++B;return""+(a||"")+b},c.util.shuffle=function(a){var b,c,d,e,f=-1,g=a?a.length:0,h=Array("number"==typeof g?g:0);for(b=0,c=a.length;b<c;b++)d=a[b],e=i(0,++f),h[f]=h[e],h[e]=d;return h},c.util.isObject=function(a){return!(!a||!n[typeof a])},c.util.isFunction=j,c.util.isArray=Array.isArray||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&s.call(a)===p||!1};var C=RegExp("^"+String(s).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");c.util.isPlainObject=Object.getPrototypeOf?function(a){if(!a||s.call(a)!==q)return!1;var b=a.valueOf,c=k(b)&&(c=Object.getPrototypeOf(b))&&Object.getPrototypeOf(c);return c?a===c||Object.getPrototypeOf(a)===c:l(a)}:l,c.util.uniq=function(a,b,c){return"boolean"!=typeof b&&null!=b&&(c=b,b=!1),m(a,b,c)};var D=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g,h=arguments,i=0,j="number"==typeof c?2:h.length;for(j>2&&"function"==typeof h[j-1]&&(g=h[--j]);++i<j;)if(e=h[i],e&&n[typeof e])for(var k=-1,l=n[typeof e]&&A(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=g?g(f[d],e[d]):e[d];return f};c.util.extend=D,c.util.defaults=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&n[typeof e])for(var j=-1,k=n[typeof e]&&A(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},c.util.sortedIndex=function(a,b,c){var d=0,e=a?a.length:d;for(c=c||o,b=c(b);d<e;){var f=d+e>>>1;c(a[f])<b?d=f+1:e=f}return d}}(),c.scratchpad=function(){var a,b,d="Error: Scratchpad used after .done() called. (Could it be unintentionally scoped?)",e="Error: Scratchpad usage space out of bounds. (Did you forget to call .done()?)",f="Error: Too many scratchpads created. (Did you forget to call .done()?)",g="Error: Object is already registered.",h=[],i=0,j=0;return a=function(){if(this._active=!1,this._indexArr=[],++i>=b.maxScratches)throw f},a.prototype={done:function(a){this._active=!1;for(var b=0;b<j;++b)this[b]=0;return h.push(this),a}},b=function k(b){if(b)return k.fn(b);var c=h.pop()||new a;return c._active=!0,c},b.maxScratches=100,b.maxIndex=20,b.fn=function(b){for(var c=[],d=0,e=b.length;d<e;d++)c.push(d);c="a"+c.join(",a");var f=new Function("fn, scratches, Scratch","return function("+c+"){ var scratch = scratches.pop() || new Scratch( scratches );scratch._active = true;return scratch.done( fn(scratch, "+c+") );};");return f(b,h,a)},b.register=function(c,f,h){var i=a.prototype,k=j++,l="_"+c+"Stack",m=h&&h.useFactory;if(c in i)throw g;a.prototype[c]=function(){var a=this[l]||(this[l]=[]),c=0|this[k];if(this[k]=c+1,!this._active)throw d;if(c>=b.maxIndex)throw e;return a[c]||(a[c]=m?f():new f)}},b.register("vector",c.vector),b.register("transform",c.transform),b}(),function(){function a(a){return a._priority_}var b=1;c.scratchpad.register("event",function(){return{}},{useFactory:!0});var d=function e(){if(!(this instanceof e))return new e};d.prototype={on:function(d,e,f,g){var h,i,j;if(this._topics=this._topics||(this._topics={}),c.util.isObject(d)){for(var k in d)this.on(k,d[k],e,f);return this}return h=this._topics[d]||(this._topics[d]=[]),i=e,c.util.isObject(f)?(e=c.util.bind(e,f),e._bindfn_=i,e._one_=i._one_,e._scope_=f):void 0===g&&(g=f),e._priority_=void 0===g?b:g,j=c.util.sortedIndex(h,e,a),h.splice(j,0,e),this},off:function(a,b,d){var e,f;if(!this._topics)return this;if(a===!0)return this._topics={},this;if(c.util.isObject(a)){for(var g in a)this.off(g,a[g]);return this}if(e=this._topics[a],!e)return this;if(b===!0)return this._topics[a]=[],this;for(var h=0,i=e.length;h<i;h++)if(f=e[h],!(f._bindfn_!==b&&f!==b||d&&f._scope_!==d)){e.splice(h,1);break}return this},emit:function(a,b){if(!this._topics)return this;var d,e,f=this._topics[a],g=f&&f.length,h=c.scratchpad();if(!g)return h.done(this);for(e=h.event(),e.topic=a,e.handler=d;g--;)d=f[g],d(b,e),d._one_&&f.splice(g,1);return h.done(this)},one:function(a,b,d){if(c.util.isObject(a)){for(var e in a)this.one(e,a[e],b,d);return this}return b._one_=!0,this.on(a,b,d),this}},c.util.pubsub=d}(),function(a){function b(){return l&&l.now?l.now()+l.timing.navigationStart:Date.now()}function d(){var c;a.requestAnimationFrame(d),j&&(c=b(),c&&k.emit("tick",c))}function e(){return j=!0,this}function f(){return j=!1,this}function g(a){return k.on("tick",a),this}function h(a){return k.off("tick",a),this}function i(){return!!j}var j=!0,k=c.util.pubsub(),l=a.performance;a.requestAnimationFrame?d():j=!1,c.util.ticker={now:b,start:e,stop:f,on:g,off:h,isActive:i}}(this),function(a){var b=function(){return!0},d=c.util.indexOf,e=function(a,b){return function(c){return a(c[b])}},f=function(a,b){return function(e){e=b?e[b]:e;var f,g=0;if(c.util.isArray(e)){if(c.util.isArray(a)){if(f=e.length,f!==a.length)return!1;for(;g<f;){if(f--,d(a,e[g])===-1||d(a,e[f])===-1)return!1;g++}return!0}return d(e,a)>-1}return e===a}},g=function(a,b){var c=f(a,b);return function(a){return!c(a)}},h=function(a,b){return function(e){e=b?e[b]:e;var f,g=0;if(c.util.isArray(e)){for(f=e.length;g<f;){if(f--,d(a,e[g])>-1||d(a,e[f])>-1)return!0;g++}return!1}return d(a,e)>-1}},i=function(a,b){var c=h(a,b);return function(a){return!c(a)}},j=function(a){return a=new c.vector(a),function(b){var d=b.aabb();return c.aabb.contains(d,a)}},k=function(a){return a.next?function(b){for(var c=a;c;){if(!c(b))return!1;c=c.next}return!0}:a},l=function(a){return a.next?function(b){for(var c=a;c;){if(c(b))return!0;c=c.next}return!1}:a},m={$eq:f,$ne:g,$in:h,$nin:i,$at:j},n=function o(a,d){var g,h,i,j,n,p;if(d){if("$or"===d||"$and"===d){for(g=0,h=a.length;g<h;++g)p=o(a[g]),n=n?n.next=p:j=p;return"$or"===d?l(j):k(j)}if(g=m[d])return g(a);throw"Unknown query operation: "+d}for(g in a)i=a[g],p="$"===g[0]?o(i,g):c.util.isPlainObject(i)?e(o(i),g):f(i,g),n=n?n.next=p:j=p;return k(j||b)};c.query=n}(this),function(){var a={priority:0};c.behavior=d("behavior",{init:function(b){this.options=c.util.options(a),this.options(b)},applyTo:function(a){return a===!0?this._targets=null:this._targets=c.util.uniq(a),this},getTargets:function(){return this._targets||(this._world?this._world._bodies:[])},setWorld:function(a){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=a,this.connect&&a&&this.connect(a),this},connect:function(a){this.behave&&a.on("integrate:positions",this.behave,this,this.options.priority)},disconnect:function(a){this.behave&&a.off("integrate:positions",this.behave,this)},behave:null})}(),function(){var a={hidden:!1,treatment:"dynamic",mass:1,restitution:1,cof:.8,view:null},b=1;2*Math.PI;c.body=d("body",{init:function(d){var e=this,f=c.vector;if(this.options=c.util.options(a,this),this.options.onChange(function(a){e.offset=new f(a.offset)}),this.options(d),this.state={pos:new f(this.x,this.y),vel:new f(this.vx,this.vy),acc:new f,angular:{pos:this.angle||0,vel:this.angularVelocity||0,acc:0},old:{pos:new f,vel:new f,acc:new f,angular:{pos:0,vel:0,acc:0}}},delete this.x,delete this.y,delete this.vx,delete this.vy,delete this.angle,delete this.angularVelocity,0===this.mass)throw"Error: Bodies must have non-zero mass";this.uid=b++,this.geometry=c.geometry("point")},sleep:function(a){return a===!0?this.asleep=!0:a===!1?this.asleep=!1:a&&!this.asleep&&this.sleepCheck(a),this.asleep},sleepCheck:function(a){var b=this._world&&this._world.options;if(!(this.sleepDisabled||b&&b.sleepDisabled)){var c,d;this.asleep&&(d=.5*this.mass*this.state.vel.dot(this.state.vel)+.5*Math.abs(this.moi*this.state.angular.vel.dot(this.state.angular.vel)),c=this.sleepEnergyLimit||b&&b.sleepEnergyLimit||0,d>=c&&this.sleep(!1))}},setWorld:function(a){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=a,this.connect&&a&&this.connect(a),this},accelerate:function(a){return"dynamic"===this.treatment&&this.state.acc.vadd(a),this},applyForce:function(a,b){if("dynamic"!==this.treatment)return this;var d,e=c.scratchpad(),f=e.vector();return b&&this.moi&&(d=this.state,f.clone(b),this.state.angular.acc-=f.cross(a)/this.moi),this.accelerate(f.clone(a).mult(1/this.mass)),e.done(),this},getGlobalOffset:function(a){return a=a||new c.vector,a.clone(this.offset).rotate(this.state.angular.pos),a},aabb:function(){var a=this.state.angular.pos,b=c.scratchpad(),d=b.vector(),e=this.geometry.aabb(a);return this.getGlobalOffset(d),e.x+=this.state.pos._[0]+d._[0],e.y+=this.state.pos._[1]+d._[1],b.done(e)},toBodyCoords:function(a){return a.vsub(this.state.pos).rotate(-this.state.angular.pos)},toWorldCoords:function(a){return a.rotate(this.state.angular.pos).vadd(this.state.pos)},recalc:function(){return this}}),c.body.getCOM=function(a,b){var d,e,f,g=a&&a.length,h=0;if(b=b||new c.vector,!g)return b.zero();if(1===g)return b.clone(a[0].state.pos);for(b.zero(),f=0;f<g;f++)d=a[f],e=d.state.pos,b.add(e._[0]*d.mass,e._[1]*d.mass),h+=d.mass;return b.mult(1/h),b}}(),function(){c.geometry=d("geometry",{init:function(a){this.options=c.util.options(),this.options(a),this._aabb=new c.aabb},aabb:function(a){return c.aabb.clone(this._aabb)},getFarthestHullPoint:function(a,b){return b=b||new c.vector,b.set(0,0)},getFarthestCorePoint:function(a,b,d){return b=b||new c.vector,b.set(0,0)}})}(),c.geometry.regularPolygonVertices=function(a,b){var c,d=[],e=2*Math.PI/a,f=0;for(c=0;c<a;c++)d.push({x:b*Math.cos(f),y:b*Math.sin(f)}),f+=e;return d},c.geometry.isPolygonConvex=function(a){var b=c.scratchpad(),d=b.vector(),e=b.vector(),f=b.vector(),g=!0,h=!1,i=a.length;if(!a||!i)return!1;if(i<3)return b.done(),g;d.clone(a[0]).vsub(f.clone(a[i-1]));for(var j=1;j<=i;++j){if(e.clone(a[j%i]).vsub(f.clone(a[(j-1)%i])),h===!1)h=d.cross(e);else if(h>0^d.cross(e)>0){g=!1;break}e.swap(d)}return b.done(),g},c.geometry.getPolygonMOI=function(a){var b,d=c.scratchpad(),e=d.vector(),f=d.vector(),g=0,h=0,i=a.length;if(i<2)return d.done(),0;if(2===i)return b=f.clone(a[1]).distSq(e.clone(a[0])),d.done(),b/12;e.clone(a[0]);for(var j=1;j<i;++j)f.clone(a[j]),b=Math.abs(f.cross(e)),g+=b*(f.normSq()+f.dot(e)+e.normSq()),h+=b,e.swap(f);return d.done(),g/(6*h)},c.geometry.isPointInPolygon=function(a,b){var d=c.scratchpad(),e=d.vector().clone(a),f=d.vector(),g=d.vector(),h=0,i=b.length;if(i<2)return h=e.equals(f.clone(b[0])),d.done(),h;if(2===i)return h=e.angle(f.clone(b[0])),h+=e.angle(f.clone(b[1])),d.done(),Math.abs(h)===Math.PI;f.clone(b[0]).vsub(e);for(var j=1;j<=i;++j)g.clone(b[j%i]).vsub(e),h+=g.angle(f),f.swap(g);return d.done(),Math.abs(h)>1e-6},c.geometry.getPolygonArea=function(a){var b=c.scratchpad(),d=b.vector(),e=b.vector(),f=0,g=a.length;if(g<3)return b.done(),0;d.clone(a[g-1]);for(var h=0;h<g;++h)e.clone(a[h]),f+=d.cross(e),d.swap(e);return b.done(),f/2},c.geometry.getPolygonCentroid=function(a){var b,d=c.scratchpad(),e=d.vector(),f=d.vector(),g=new c.vector,h=a.length;if(h<2)return d.done(),new c.vector(a[0]);if(2===h)return d.done(),new c.vector((a[1].x+a[0].x)/2,(a[1].y+a[0].y)/2);e.clone(a[h-1]);for(var i=0;i<h;++i)f.clone(a[i]),b=e.cross(f),e.vadd(f).mult(b),g.vadd(e),e.swap(f);return b=1/(6*c.geometry.getPolygonArea(a)),d.done(),g.mult(b)},c.geometry.nearestPointOnLine=function(a,b,d){var e,f,g=c.scratchpad(),h=g.vector().clone(a),i=g.vector().clone(b).vsub(h),j=g.vector().clone(d).vsub(h).vsub(i);return j.equals(c.vector.zero)?(g.done(),new c.vector(b)):(e=-j.dot(i)/j.normSq(),f=1-e,f<=0?(g.done(),new c.vector(d)):e<=0?(g.done(),new c.vector(b)):(h=new c.vector(d).mult(e).vadd(i.clone(b).mult(f)),g.done(),h))},function(){var a={drag:0};c.integrator=d("integrator",{init:function(b){this.options=c.util.options(a),this.options(b)},setWorld:function(a){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=a,this.connect&&a&&this.connect(a),this},integrate:function(a,b){var c=this._world;return this.integrateVelocities(a,b),c&&c.emit("integrate:velocities",{bodies:a,dt:b}),this.integratePositions(a,b),c&&c.emit("integrate:positions",{bodies:a,dt:b}),this},connect:null,disconnect:null,integrateVelocities:function(a,b){throw"The integrator.integrateVelocities() method must be overriden"},integratePositions:function(a,b){throw"The integrator.integratePositions() method must be overriden"}})}(),function(){var e={meta:!1,metaRefresh:200,width:600,height:600,autoResize:!0};c.renderer=d("renderer",{init:function(d){var f=this,g="string"==typeof d.el?b.getElementById(d.el):d.el;this.options=c.util.options(e),this.options(d),this.el=g?g:b.body,this.container=g&&g.parentNode?g.parentNode:b.body,this.drawMeta=c.util.throttle(c.util.bind(this.drawMeta,this),this.options.metaRefresh),a.addEventListener("resize",c.util.throttle(function(){f.options.autoResize&&f.resize()}),100)},resize:function(a,b){void 0===a&&void 0===b&&(a=this.container.offsetWidth,b=this.container.offsetHeight),this.width=a||0,this.height=b||0},setWorld:function(a){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=a,this.connect&&a&&this.connect(a),this},render:function(a,b){var c,d;this.beforeRender&&this.beforeRender(),this._world.emit("beforeRender",{renderer:this,bodies:a,meta:b}),this.options.meta&&this.drawMeta(b),this._interpolateTime=b.interpolateTime;for(var e=0,f=a.length;e<f;++e)c=a[e],d=c.view||(c.view=this.createView(c.geometry,c.styles)),c.hidden||this.drawBody(c,d);return this},createView:function(a,b){throw"You must override the renderer.createView() method."},drawMeta:function(a){throw"You must override the renderer.drawMeta() method."},drawBody:function(a,b){throw"You must override the renderer.drawBody() method."}})}(),function(){var a=function e(a,b,c){for(var d,f,g=function(){return e(a,b,c)};d=a.shift();)if(f=d.apply(b,c),f&&f.then)return f.then(g)},b={timestep:6,maxIPF:4,webworker:!1,integrator:"verlet",sleepDisabled:!1,sleepEnergyLimit:1e-8,sleepTimeLimit:500},d=function f(a,b){return this instanceof f?void this.init(a,b):new f(a,b)};d.prototype=c.util.extend({},c.util.pubsub.prototype,{init:function(d,e){var f=this;(c.util.isFunction(d)||c.util.isArray(d))&&(e=d,d={}),this._meta={fps:0,ipf:0},this._bodies=[],this._behaviors=[],this._integrator=null,this._renderer=null,this._paused=!1,this._warp=1,this._time=0,this.options=c.util.options(b),this.options.onChange(function(a){f.timestep(a.timestep)}),this.options(d),this.add(c.integrator(this.options.integrator)),c.util.isFunction(e)?a([e],this,[this,c]):c.util.isArray(e)&&a(e,this,[this,c])},options:null,add:function(a){var b=0,d=a&&a.length||0,e=c.util.isArray(a)?a[0]:a;if(!e)return this;do switch(e.type){case"behavior":this.addBehavior(e);break;case"integrator":this.integrator(e);break;case"renderer":this.renderer(e);break;case"body":this.addBody(e);break;default:throw'Error: failed to add item of unknown type "'+e.type+'" to world'}while(++b<d&&(e=a[b]));return this},remove:function(a){var b=0,d=a&&a.length||0,e=c.util.isArray(a)?a[0]:a;if(!e)return this;do switch(e.type){case"behavior":this.removeBehavior(e);break;case"integrator":e===this._integrator&&this.integrator(null);break;case"renderer":e===this._renderer&&this.renderer(null);break;case"body":this.removeBody(e);break;default:throw'Error: failed to remove item of unknown type "'+e.type+'" from world'}while(++b<d&&(e=a[b]));return this},has:function(a){var b;if(!a)return!1;switch(a.type){case"behavior":b=this._behaviors;break;case"integrator":return this._integrator===a;case"renderer":return this._renderer===a;case"body":b=this._bodies;break;default:throw'Error: unknown type "'+a.type+'"'}return c.util.indexOf(b,a)>-1},integrator:function(a){return void 0===a?this._integrator:this._integrator===a?this:(this._integrator&&(this._integrator.setWorld(null),this.emit("remove:integrator",{integrator:this._integrator})),a&&(this._integrator=a,this._integrator.setWorld(this),this.emit("add:integrator",{integrator:this._integrator})),this)},renderer:function(a){return void 0===a?this._renderer:this._renderer===a?this:(this._renderer&&(this._renderer.setWorld(null),this.emit("remove:renderer",{renderer:this._renderer})),a&&(this._renderer=a,this._renderer.setWorld(this),this.emit("add:renderer",{renderer:this._renderer})),this)},timestep:function(a){return a?(this._dt=+a.toPrecision(4),this._maxJump=a*this.options.maxIPF,this):this._dt},wakeUpAll:function(){var a=0,b=this._bodies.length;for(a=0;a<b;a++)this._bodies[a].sleep(!1)},addBehavior:function(a){return this.has(a)?this:(a.setWorld(this),this._behaviors.push(a),this.emit("add:behavior",{behavior:a}),this)},getBehaviors:function(){return[].concat(this._behaviors)},removeBehavior:function(a){var b=this._behaviors;if(a)for(var c=0,d=b.length;c<d;++c)if(a===b[c]){b.splice(c,1),a.setWorld(null),this.emit("remove:behavior",{behavior:a});break}return this},addBody:function(a){return this.has(a)?this:(a.setWorld(this),this._bodies.push(a),this.emit("add:body",{body:a}),this)},getBodies:function(){return[].concat(this._bodies)},removeBody:function(a){var b=this._bodies;if(a)for(var c=0,d=b.length;c<d;++c)if(a===b[c]){b.splice(c,1),a.setWorld(null),this.emit("remove:body",{body:a});break}return this},findOne:function(a){var b=this,d="function"==typeof a?a:c.query(a);return c.util.find(b._bodies,d)||!1},find:function(a){var b=this,d="function"==typeof a?a:c.query(a);return c.util.filter(b._bodies,d)},iterate:function(a){this._integrator.integrate(this._bodies,a)},step:function(a){var b,d,e,f=this._time,g=this._warp,h=1/g,i=this._dt,j=i*h,k=this._maxJump*h,l=this._meta;if(this._paused||void 0===this._animTime)return this._animTime=a||this._animTime||c.util.ticker.now(),this._paused||this.emit("step",l),this;if(a=a||this._animTime+j,b=a-this._animTime,b>k&&(this._animTime=a-k,b=k),d=b*g,e=f+d-i,this.emit("beforeStep"),f<=e)for(;f<=e;)f+=i,this._animTime+=j,this._time=f,this.iterate(i);return l.fps=1e3/(a-this._lastTime),l.ipf=(d/i).toFixed(2),l.interpolateTime=i+e-f,this._lastTime=a,this.emit("step",l),this},warp:function(a){return void 0===a?this._warp:(this._warp=a||1,this)},render:function(){if(!this._renderer)throw"No renderer added to world";return this._renderer.render(this._bodies,this._meta),this.emit("render",{bodies:this._bodies,meta:this._meta,renderer:this._renderer}),this},pause:function(){return this._paused=!0,this.emit("pause"),this},unpause:function(){return this._paused=!1,this.emit("unpause"),this},isPaused:function(){return!!this._paused},destroy:function(){var a=this;a.pause(),this.emit("destroy"),a.off(!0),a.remove(a.getBodies()),a.remove(a.getBehaviors()),a.integrator(null),a.renderer(null)}}),c.world=d}(),c.integrator("verlet",function(a){return c.body.mixin({started:function(a){return void 0!==a&&(this._started=!0),!!this._started}}),{init:function(b){a.init.call(this,b)},integrateVelocities:function(a,b){for(var c,d=b*b,e=1-this.options.drag,f=null,g=this.prevDt||b,h=.5*(d+b*g),i=0,j=a.length;i<j;++i)f=a[i],c=f.state,"static"===f.treatment||f.sleep(b)?(c.vel.zero(),c.acc.zero(),c.angular.vel=0,c.angular.acc=0):(c.vel.equals(c.old.vel)&&f.started()?c.vel.clone(c.pos).vsub(c.old.pos):(c.old.pos.clone(c.pos).vsub(c.vel),c.vel.mult(b)),e&&c.vel.mult(e),c.vel.vadd(c.acc.mult(h)),c.vel.mult(1/b),c.old.vel.clone(c.vel),c.acc.zero(),c.angular.vel===c.old.angular.vel&&f.started()?c.angular.vel=c.angular.pos-c.old.angular.pos:(c.old.angular.pos=c.angular.pos-c.angular.vel,c.angular.vel*=b),c.angular.vel+=c.angular.acc*h,c.angular.vel/=b,c.old.angular.vel=c.angular.vel,
c.angular.acc=0,f.started(!0))},integratePositions:function(a,b){for(var c,d=null,e=this.prevDt||b,f=b/e,g=0,h=a.length;g<h;++g)d=a[g],c=d.state,"static"===d.treatment||d.sleep()||(c.vel.mult(b*f),c.old.pos.clone(c.pos),c.pos.vadd(c.vel),c.vel.mult(1/(b*f)),c.old.vel.clone(c.vel),c.angular.vel*=b*f,c.old.angular.pos=c.angular.pos,c.angular.pos+=c.angular.vel,c.angular.vel/=b*f,c.old.angular.vel=c.angular.vel);this.prevDt=b}}}),c.geometry("point",function(a){}),c.body("point",function(a){return{init:function(b){a.init.call(this,b),this.moi=0}}}),c.geometry("circle",function(a){var b={radius:1};return{init:function(d){a.init.call(this,d),this.options.defaults(b),this.options.onChange(function(a){this.radius=a.radius}),this.options(d),this._aabb=c.aabb(),this.radius=this.options.radius},aabb:function(a){var b=this.radius;return this._aabb.hw!==b&&(this._aabb=c.aabb(-b,-b,b,b)),c.aabb.clone(this._aabb)},getFarthestHullPoint:function(a,b){return b=b||new c.vector,b.clone(a).normalize().mult(this.radius)},getFarthestCorePoint:function(a,b,d){return b=b||new c.vector,b.clone(a).normalize().mult(this.radius-d)}}}),c.geometry("compound",function(a){var b={};return{init:function(c){a.init.call(this,c),this.options.defaults(b),this.options(c),this.children=[]},addChild:function(a,b,d){return this._aabb=null,this.children.push({g:a,pos:new c.vector(b),angle:d}),this},clear:function(){return this._aabb=null,this.children=[],this},aabb:function(a){if(!a&&this._aabb)return c.aabb.clone(this._aabb);var b,d,e,f=c.scratchpad(),g=c.vector();a=a||0;for(var h=0,i=this.children.length;h<i;h++)d=this.children[h],b=d.g.aabb(a+d.angle),g.clone(d.pos),a&&g.rotate(a),b.x+=g._[0],b.y+=g._[1],e=e?c.aabb.union(e,b,!0):b;return a||(this._aabb=c.aabb.clone(e)),f.done(e)},getFarthestHullPoint:function(a,b){var d,e,f=this.children.length,g=c.scratchpad(),h=g.vector(),i=0,j=0;for(b=b||new c.vector,e=0;e<f;e++)d=this.children[e],d.g.getFarthestHullPoint(a.rotate(-d.angle),h),i=h.rotate(d.angle).vadd(d.pos).proj(a.rotate(d.angle)),i>j&&(j=i,b.swap(h));return g.done(b)},getFarthestCorePoint:function(a,b,d){var e,f,g=this.children.length,h=c.scratchpad(),i=h.vector(),j=0,k=0;for(b=b||new c.vector,f=0;f<g;f++)e=this.children[f],e.g.getFarthestCorePoint(a.rotate(-e.angle),i,d),j=i.rotate(e.angle).vadd(e.pos).proj(a.rotate(e.angle)),j>k&&(k=j,b.swap(i));return h.done(b)}}}),c.geometry("convex-polygon",function(a){var b="Error: The vertices specified do not match that of a _convex_ polygon.",d={};return{init:function(b){var c=this;a.init.call(this,b),this.options.defaults(d),this.options.onChange(function(a){c.setVertices(a.vertices||[])}),this.options(b),c.setVertices(this.options.vertices||[])},setVertices:function(a){var d=c.scratchpad(),e=d.transform(),f=this.vertices=[];if(!c.geometry.isPolygonConvex(a))throw b;e.setRotation(0),e.setTranslation(c.geometry.getPolygonCentroid(a).negate());for(var g=0,h=a.length;g<h;++g)f.push(new c.vector(a[g]).translate(e));return this._area=c.geometry.getPolygonArea(f),this._aabb=!1,d.done(this)},aabb:function(a){if(!a&&this._aabb)return c.aabb.clone(this._aabb);var b,d=c.scratchpad(),e=d.vector(),f=d.transform().setRotation(a||0),g=d.vector().set(1,0).rotateInv(f),h=d.vector().set(0,1).rotateInv(f),i=this.getFarthestHullPoint(g,e).proj(g),j=-this.getFarthestHullPoint(g.negate(),e).proj(g),k=this.getFarthestHullPoint(h,e).proj(h),l=-this.getFarthestHullPoint(h.negate(),e).proj(h);return b=c.aabb(j,l,i,k),a||(this._aabb=c.aabb.clone(b)),d.done(),b},getFarthestHullPoint:function(a,b,d){var e,f,g,h=this.vertices,i=h.length,j=2;if(b=b||new c.vector,i<2)return d&&(d.idx=0),b.clone(h[0]);if(f=h[0].dot(a),e=h[1].dot(a),2===i)return g=e>=f?1:0,d&&(d.idx=g),b.clone(h[g]);if(e>=f){for(;j<i&&e>=f;)f=e,e=h[j].dot(a),j++;return e>=f&&j++,g=j-2,d&&(d.idx=j-2),b.clone(h[g])}for(j=i;j>1&&f>=e;)j--,e=f,f=h[j].dot(a);return g=(j+1)%i,d&&(d.idx=g),b.clone(h[g])},getFarthestCorePoint:function(a,b,d){var e,f=c.scratchpad(),g=f.vector(),h=f.vector(),i=this.vertices,j=i.length,k=this._area>0,l={};return b=this.getFarthestHullPoint(a,b,l),g.clone(i[(l.idx+1)%j]).vsub(b).normalize().perp(k),h.clone(i[(l.idx-1+j)%j]).vsub(b).normalize().perp(!k),e=d/(1+g.dot(h)),b.vadd(g.vadd(h).mult(e)),f.done(),b}}}),c.geometry("rectangle",function(a){var b={};return{init:function(c){var d=this;a.init.call(this,c),this.options.defaults(b),this.options.onChange(function(a){d.width=d.options.width||1,d.height=d.options.height||1}),this.options(c)},aabb:function(a){if(!a)return c.aabb(this.width,this.height);var b=c.scratchpad(),d=b.vector(),e=b.transform().setRotation(a||0),f=b.vector().set(1,0).rotateInv(e),g=b.vector().set(0,1).rotateInv(e),h=this.getFarthestHullPoint(f,d).proj(f),i=-this.getFarthestHullPoint(f.negate(),d).proj(f),j=this.getFarthestHullPoint(g,d).proj(g),k=-this.getFarthestHullPoint(g.negate(),d).proj(g);return b.done(),c.aabb(i,k,h,j)},getFarthestHullPoint:function(a,b){b=b||new c.vector;var d=a.x,e=a.y;return d=0===d?0:d<0?.5*-this.width:.5*this.width,e=0===e?0:e<0?.5*-this.height:.5*this.height,b.set(d,e)},getFarthestCorePoint:function(a,b,c){var d,e;return b=this.getFarthestHullPoint(a,b),d=b.x,e=b.y,b.x=0===d?0:d<0?d+c:d-c,b.y=0===e?0:e<0?e+c:e-c,b}}}),c.body("circle",function(a){var b={radius:1};return{init:function(d){a.init.call(this,d),d=c.util.extend({},b,d),this.geometry=c.geometry("circle",{radius:d.radius}),this.recalc()},recalc:function(){a.recalc.call(this),this.moi=this.mass*this.geometry.radius*this.geometry.radius/2}}}),c.body("compound",function(a){return{init:function(b){a.init.call(this,b),this.mass=0,this.moi=0,this.children=[],this.geometry=c.geometry("compound"),this.addChildren(b.children)},connect:function(a){if(this.mass<=0)throw"Can not add empty compound body to world."},addChild:function(a){return this.addChildren([a]),this},addChildren:function(a){var b,d,e,f=this,g=c.scratchpad(),h=g.vector().zero(),i=a&&a.length,j=0;if(!i)return g.done(this);for(e=0;e<i;e++)b=a[e],b._world&&b._world.remove(b),this.children.push(b),this.geometry.addChild(b.geometry,new c.vector(b.offset).rotate(b.state.angular.pos).vadd(b.state.pos),b.state.angular.pos),d=b.state.pos,h.add(d._[0]*b.mass,d._[1]*b.mass),j+=b.mass;return this.mass+=j,h.mult(1/this.mass),this.offset.vsub(h),this._world&&this._world.one("render",function(){f.view=null}),this.recalc(),g.done(this)},clear:function(){return this._aabb=null,this.moi=0,this.mass=0,this.offset.zero(),this.children=[],this.geometry.clear(),this},refreshGeometry:function(){this.geometry.clear();for(var a,b=0,d=this.children.length;b<d;b++)a=this.children[b],this.geometry.addChild(a.geometry,new c.vector(a.state.pos).vadd(a.offset),a.state.angular.pos);return this},recalc:function(){a.recalc.call(this);for(var b,c=0,d=0,e=this.children.length;d<e;d++)b=this.children[d],b.recalc(),c+=b.moi+b.mass*b.state.pos.normSq();return this.moi=c,this}}}),c.body("convex-polygon",function(a){var b={};return{init:function(d){a.init.call(this,d),d=c.util.extend({},b,d),this.geometry=c.geometry("convex-polygon",{vertices:d.vertices}),this.recalc()},recalc:function(){a.recalc.call(this),this.moi=c.geometry.getPolygonMOI(this.geometry.vertices)}}}),c.body("rectangle",function(a){var b={};return{init:function(d){a.init.call(this,d),d=c.util.extend({},b,d),this.geometry=c.geometry("rectangle",{width:d.width,height:d.height}),this.recalc()},recalc:function(){var b=this.geometry.width,c=this.geometry.height;a.recalc.call(this),this.moi=(b*b+c*c)*this.mass/12}}}),c.behavior("attractor",function(a){var b={pos:null,strength:1,order:2,max:!1,min:!1};return{init:function(d){var e=this;this._pos=new c.vector,a.init.call(this),this.options.defaults(b),this.options.onChange(function(a){e._maxDist=a.max===!1?1/0:a.max,e._minDist=a.min?a.min:10,e.position(a.pos)}),this.options(d)},position:function(a){var b=this;return a?(this._pos.clone(a),b):this._pos.values()},behave:function(a){for(var b,d,e,f=this.getTargets(),g=this.options.order,h=this.options.strength,i=this._minDist,j=this._maxDist,k=c.scratchpad(),l=k.vector(),m=0,n=f.length;m<n;m++)b=f[m],l.clone(this._pos),l.vsub(b.state.pos),d=l.norm(),d>i&&d<j&&(e=h/Math.pow(d,g),b.accelerate(l.normalize().mult(e)));k.done()}}}),c.behavior("body-collision-detection",function(a){var b=[],d=function(a,d){var e=c.util.pairHash(a.uid,d.uid),f=b[e];return f||(f=b[e]=function(b){var c=f.tA,e=f.tB,g=f.tmpv1,h=f.tmpv2;return f.useCore?(g=a.geometry.getFarthestCorePoint(b.rotateInv(c),g,f.marginA),h=d.geometry.getFarthestCorePoint(b.rotate(c).rotateInv(e).negate(),h,f.marginB)):(g=a.geometry.getFarthestHullPoint(b.rotateInv(c),g),h=d.geometry.getFarthestHullPoint(b.rotate(c).rotateInv(e).negate(),h)),g.vadd(a.offset).transform(c),h.vadd(d.offset).transform(e),b.negate().rotate(e),{a:g.values(),b:h.values(),pt:g.vsub(h).values()}},f.tA=new c.transform,f.tB=new c.transform,f.tmpv1=new c.vector,f.tmpv2=new c.vector),f.useCore=!1,f.margin=0,f.tA.setRotation(a.state.angular.pos).setTranslation(a.state.pos),f.tB.setRotation(d.state.angular.pos).setTranslation(d.state.pos),f.bodyA=a,f.bodyB=d,f},e=function(a,b){var e,f,g,h,i=c.scratchpad(),j=i.vector(),k=i.vector(),l=i.vector(),m=!1,n=a.aabb(),o=Math.min(n.hw,n.hh),p=b.aabb(),q=Math.min(p.hw,p.hh);if(g=d(a,b),j.clone(a.state.pos).vadd(a.getGlobalOffset(l)).vsub(b.state.pos).vsub(b.getGlobalOffset(l)),f=c.gjk(g,j,!0),f.overlap){for(m={bodyA:a,bodyB:b},h=.01*Math.min(o||1,q||1),g.useCore=!0,g.marginA=0,g.marginB=0;(f.overlap||0===f.distance)&&(g.marginA<o||g.marginB<q);)g.marginA<o&&(g.marginA+=h),g.marginB<q&&(g.marginB+=h),f=c.gjk(g,j);if(f.overlap||f.maxIterationsReached)return i.done(!1);if(e=g.marginA+g.marginB-f.distance,e<=0)return i.done(!1);m.overlap=e,m.norm=j.clone(f.closest.b).vsub(k.clone(f.closest.a)).normalize().values(),m.mtv=j.mult(e).values(),m.pos=j.clone(m.norm).mult(g.marginA).vadd(k.clone(f.closest.a)).vsub(a.state.pos).values()}return i.done(m)},f=function(a,b){var d,e=c.scratchpad(),f=e.vector(),g=e.vector(),h=!1;return f.clone(b.state.pos).vadd(b.getGlobalOffset(g)).vsub(a.state.pos).vsub(a.getGlobalOffset(g)),d=f.norm()-(a.geometry.radius+b.geometry.radius),f.equals(c.vector.zero)&&f.set(1,0),d<=0&&(h={bodyA:a,bodyB:b,norm:f.normalize().values(),mtv:f.mult(-d).values(),pos:f.mult(-a.geometry.radius/d).vadd(g).values(),overlap:-d}),e.done(h)},g=function i(a,b){if(!("static"!==a.treatment&&"kinematic"!==a.treatment||"static"!==b.treatment&&"kinematic"!==b.treatment))return!1;if("circle"===a.geometry.name&&"circle"===b.geometry.name)return f(a,b);if("compound"===a.geometry.name||"compound"===b.geometry.name){var d,g,h,j,k="compound"===a.geometry.name,l=k?a:b,m=k?b:a,n=[],o=c.scratchpad(),p=(o.vector(),o.vector()),q=m.aabb();for(h=0,j=l.children.length;h<j;h++){if(g=l.children[h],p.clone(g.state.pos),g.offset.vadd(p.vadd(l.offset).rotate(-g.state.angular.pos)),g.state.pos.clone(l.state.pos),g.state.angular.pos+=l.state.angular.pos,c.aabb.overlap(q,g.aabb()))if(d=i(m,g),d instanceof Array)for(var r,s=0,t=d.length;s<t;s++)r=d[s],r.bodyA===g?r.bodyA=l:r.bodyB=l,n.push(r);else d&&(d.bodyA===g?d.bodyA=l:d.bodyB=l,n.push(d));g.state.angular.pos-=l.state.angular.pos,g.offset.vsub(p),g.state.pos.clone(p.rotate(g.state.angular.pos).vsub(l.offset))}return o.done(n)}return e(a,b)},h={check:"collisions:candidates",channel:"collisions:detected"};return{init:function(b){a.init.call(this),this.options.defaults(h),this.options(b)},connect:function(a){this.options.check===!0?a.on("integrate:velocities",this.checkAll,this):a.on(this.options.check,this.check,this)},disconnect:function(a){this.options.check===!0?a.off("integrate:velocities",this.checkAll,this):a.off(this.options.check,this.check,this)},check:function(a){for(var b,d,e,f=a.candidates,h=this.getTargets(),i=[],j=this.prevContacts||{},k={},l=c.util.pairHash,m=0,n=f.length;m<n;++m)if(b=f[m],h===this._world._bodies||c.util.indexOf(h,b.bodyA)>-1&&c.util.indexOf(h,b.bodyB)>-1)if(d=g(b.bodyA,b.bodyB),d instanceof Array)for(var o,p=0,q=d.length;p<q;p++)o=d[p],o&&(e=l(b.bodyA.uid,b.bodyB.uid),k[e]=!0,o.collidedPreviously=j[e],i.push(o));else d&&(e=l(b.bodyA.uid,b.bodyB.uid),k[e]=!0,d.collidedPreviously=j[e],i.push(d));this.prevContacts=k,i.length&&this._world.emit(this.options.channel,{collisions:i})},checkAll:function(a){for(var b,d,e,f,h=this.getTargets(),i=(a.dt,[]),j=this.prevContacts||{},k={},l=c.util.pairHash,m=0,n=h.length;m<n;m++){b=h[m];for(var o=m+1;o<n;o++)if(d=h[o],e=g(b,d),e instanceof Array)for(var p,q=0,r=e.length;q<r;q++)p=e[q],p&&(f=l(b.uid,d.uid),k[f]=!0,p.collidedPreviously=j[f],i.push(p));else e&&(f=l(b.uid,d.uid),k[f]=!0,e.collidedPreviously=j[f],i.push(e))}this.prevContacts=k,i.length&&this._world.emit(this.options.channel,{collisions:i})}}}),c.behavior("body-impulse-response",function(a){function b(a){return a.uid}function d(a,b,c){var d,e;return e=b.norm(),d=e-a.proj(b),d=Math.max(0,Math.min(e,d)),0===e?c.zero():c.clone(b).mult(d/e),c}var e={check:"collisions:detected",mtvThreshold:1,bodyExtractDropoff:.5,forceWakeupAboveOverlapThreshold:!0};return{init:function(b){a.init.call(this),this.options.defaults(e),this.options(b),this._bodyList=[]},applyTo:!1,connect:function(a){a.on(this.options.check,this.respond,this)},disconnect:function(a){a.off(this.options.check,this.respond,this)},collideBodies:function(a,b,e,f,g,h){var i="static"===a.treatment||"kinematic"===a.treatment,j="static"===b.treatment||"kinematic"===b.treatment,k=c.scratchpad(),l=k.vector().clone(g);if(i&&j)return void k.done();var m,n,o,p,q=i?0:1/a.moi,r=j?0:1/b.moi,s=i?0:1/a.mass,t=j?0:1/b.mass,u=a.restitution*b.restitution,v=a.cof*b.cof,w=k.vector().clone(e),x=k.vector().clone(w).perp(),y=k.vector(),z=k.vector().clone(f),A=k.vector().clone(f).vadd(a.state.pos).vsub(b.state.pos),B=a.state.angular.vel,C=b.state.angular.vel,D=k.vector().clone(b.state.vel).vadd(y.clone(A).perp().mult(C)).vsub(a.state.vel).vsub(y.clone(z).perp().mult(B)),E=z.proj(w),F=z.proj(x),G=A.proj(w),H=A.proj(x),I=D.proj(w),J=D.proj(x);return h&&(i?(d(b._mtvTotal,l,y),b._mtvTotal.vadd(y)):j?(d(a._mtvTotal,l.negate(),y),a._mtvTotal.vadd(y),l.negate()):(p=.5,l.mult(p),d(b._mtvTotal,l,y),b._mtvTotal.vadd(y),l.clone(g).mult(p-1),d(a._mtvTotal,l,y),a._mtvTotal.vadd(y))),I>=0?void k.done():(q=q===1/0?0:q,r=r===1/0?0:r,m=-((1+u)*I)/(s+t+q*F*F+r*H*H),i?(b.state.vel.vadd(w.mult(m*t)),b.state.angular.vel-=m*r*H):j?(a.state.vel.vsub(w.mult(m*s)),a.state.angular.vel+=m*q*F):(b.state.vel.vadd(w.mult(m*t)),b.state.angular.vel-=m*r*H,a.state.vel.vsub(w.mult(s*b.mass)),a.state.angular.vel+=m*q*F),v&&J&&(o=Math.abs(J)/(s+t+q*E*E+r*G*G),n=J<0?-1:1,m=v*Math.abs(m),m=Math.min(m,o),m*=n,i?(b.state.vel.vsub(x.mult(m*t)),b.state.angular.vel-=m*r*G):j?(a.state.vel.vadd(x.mult(m*s)),a.state.angular.vel+=m*q*E):(b.state.vel.vsub(x.mult(m*t)),b.state.angular.vel-=m*r*G,a.state.vel.vadd(x.mult(s*b.mass)),a.state.angular.vel+=m*q*E)),a.sleep()&&a.sleepCheck(),b.sleep()&&b.sleepCheck(),void k.done())},_pushUniq:function(a){var d=c.util.sortedIndex(this._bodyList,a,b);this._bodyList[d]!==a&&this._bodyList.splice(d,0,a)},respond:function(a){var b,d,e,f,g=this,h=a.collisions;for(d=0,e=h.length;d<e;++d)b=h[d],this._pushUniq(b.bodyA),this._pushUniq(b.bodyB),b.bodyA._mtvTotal=b.bodyA._mtvTotal||new c.vector,b.bodyB._mtvTotal=b.bodyB._mtvTotal||new c.vector,b.bodyA._oldmtvTotal=b.bodyA._oldmtvTotal||new c.vector,b.bodyB._oldmtvTotal=b.bodyB._oldmtvTotal||new c.vector,g.collideBodies(b.bodyA,b.bodyB,b.norm,b.pos,b.mtv,b.collidedPreviously);for(d=0,e=this._bodyList.length;d<e;++d)f=this._bodyList.pop(),f._mtvTotal.normSq()<this.options.mtvThreshold?f._mtvTotal.mult(this.options.bodyExtractDropoff):this.options.forceWakeupAboveOverlapThreshold&&f.sleep(!1),f.state.pos.vadd(f._mtvTotal),f.state.old.pos.vadd(f._mtvTotal),f._oldmtvTotal.swap(f._mtvTotal),f._mtvTotal.zero()}}}),c.behavior("constant-acceleration",function(a){var b={acc:{x:0,y:4e-4}};return{init:function(d){a.init.call(this),this.options.defaults(b),this.options(d),this._acc=new c.vector,this.setAcceleration(this.options.acc),delete this.options.acc},setAcceleration:function(a){return this._acc.clone(a),this},behave:function(a){for(var b=this.getTargets(),c=0,d=b.length;c<d;++c)b[c].accelerate(this._acc)}}}),c.behavior("edge-collision-detection",function(a){var b=function(a,b,d){var e,f=a.aabb(),g=c.scratchpad(),h=a.getGlobalOffset(g.vector()),i=g.transform(),j=g.vector(),k=g.vector(),l=!1,m=[];return e=f.x+f.hw-b.max.x,e>=0&&(j.set(1,0).rotateInv(i.setRotation(a.state.angular.pos)),l={bodyA:a,bodyB:d,overlap:e,norm:{x:1,y:0},mtv:{x:e,y:0},pos:a.geometry.getFarthestHullPoint(j,k).rotate(i).vadd(h).values()},m.push(l)),e=f.y+f.hh-b.max.y,e>=0&&(j.set(0,1).rotateInv(i.setRotation(a.state.angular.pos)),l={bodyA:a,bodyB:d,overlap:e,norm:{x:0,y:1},mtv:{x:0,y:e},pos:a.geometry.getFarthestHullPoint(j,k).rotate(i).vadd(h).values()},m.push(l)),e=b.min.x-(f.x-f.hw),e>=0&&(j.set(-1,0).rotateInv(i.setRotation(a.state.angular.pos)),l={bodyA:a,bodyB:d,overlap:e,norm:{x:-1,y:0},mtv:{x:-e,y:0},pos:a.geometry.getFarthestHullPoint(j,k).rotate(i).vadd(h).values()},m.push(l)),e=b.min.y-(f.y-f.hh),e>=0&&(j.set(0,-1).rotateInv(i.setRotation(a.state.angular.pos)),l={bodyA:a,bodyB:d,overlap:e,norm:{x:0,y:-1},mtv:{x:0,y:-e},pos:a.geometry.getFarthestHullPoint(j,k).rotate(i).vadd(h).values()},m.push(l)),g.done(),m},d=function(a,c,d){return b(a,c,d)},e={aabb:null,restitution:.99,cof:1,channel:"collisions:detected"};return{init:function(b){a.init.call(this),this.options.defaults(e),this.options(b),this.setAABB(this.options.aabb),this.restitution=this.options.restitution,this.body=c.body("point",{treatment:"static",restitution:this.options.restitution,cof:this.options.cof})},setAABB:function(a){if(!a)throw"Error: aabb not set";return this._edges={min:{x:a.x-a.hw,y:a.y-a.hh},max:{x:a.x+a.hw,y:a.y+a.hh}},this},connect:function(a){a.on("integrate:positions",this.checkAll,this,2)},disconnect:function(a){a.off("integrate:positions",this.checkAll,this,2)},checkAll:function(a){for(var b,e,f,g=this.getTargets(),h=(a.dt,[]),i=this._edges,j=this.body,k=this.prevContacts||{},l={},m=c.util.pairHash,n=0,o=g.length;n<o;n++)if(b=g[n],"dynamic"===b.treatment&&(e=d(b,i,j))){f=m(b.uid,j.uid);for(var p=0,q=e.length;p<q;p++)l[f]=!0,e[p].collidedPreviously=k[f];h.push.apply(h,e)}this.prevContacts=l,h.length&&this._world.emit(this.options.channel,{collisions:h})}}}),c.behavior("interactive",function(d){if(!b)return{};var e={el:null,moveThrottle:10,minVel:{x:-5,y:-5},maxVel:{x:5,y:5}},f=function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}};return{init:function(a){var g=this;if(d.init.call(this),this.options.defaults(e),this.options(a),this.bodyData={},this.bodyDataByUID={},this.el="string"==typeof this.options.el?b.getElementById(this.options.el):this.options.el,!this.el)throw"No DOM element specified";g.grab=function(a){var b,d,e,h,i,j,k,l;if(g._world)for(a.changedTouches||(a.changedTouches=[a]),i=f(a.target),k=0,l=a.changedTouches.length;k<l;k++)h=a.changedTouches[k],e=h.identifier||h.pointerId||"mouse",b={idx:e,x:h.pageX-i.left,y:h.pageY-i.top},d=g._world.findOne({$at:new c.vector(b),$in:g.getTargets()}),d?(d.state.vel.zero(),d.state.angular.vel=0,d.isGrabbed=!0,j=g.bodyData[e]||{},j.body=d,d.sleep(!1),j.time=c.util.ticker.now(),j.treatment=g.bodyDataByUID[d.uid]?g.bodyDataByUID[d.uid].treatment:d.treatment,d.treatment="kinematic",j.pos=j.pos||new c.vector,j.pos.clone(b),j.offset=j.offset||new c.vector,j.offset.clone(b).vsub(d.state.pos),j.oldPos=j.oldPos||new c.vector,j.oldPos.clone(b),b.body=d,g.bodyData[e]=j,g.bodyDataByUID[d.uid]=j,g._world.emit("interact:grab",b)):g._world.emit("interact:poke",b)},g.move=c.util.throttle(function(a){var b,d,e,h,i,j,k,l;if(g._world)for(a.changedTouches||(a.changedTouches=[a]),i=f(g.el),k=0,l=a.changedTouches.length;k<l;k++)h=a.changedTouches[k],e=h.identifier||h.pointerId||"mouse",b={idx:e,x:h.pageX-i.left,y:h.pageY-i.top},j=g.bodyData[e],j&&(d=j.body,d.sleep(!1),j.time=c.util.ticker.now(),j.oldPos.clone(j.pos),j.pos.clone(b),b.body=d),g._world.emit("interact:move",b)},g.options.moveThrottle),g.release=function(a){var b,d,e,h,i,j,k,l,m;if(g._world)for(a.changedTouches||(a.changedTouches=[a]),l=0,m=a.changedTouches.length;l<m;l++)i=f(g.el),h=a.changedTouches[l],e=h.identifier||h.pointerId||"mouse",b={idx:e,x:h.pageX-i.left,y:h.pageY-i.top},j=g.bodyData[e],j&&(d=j.body,d.sleep(!1),j.pos.clone(b),k=Math.max(c.util.ticker.now()-j.time,g.options.moveThrottle),d.treatment=j.treatment,d.state.vel.clone(j.pos).vsub(j.oldPos).mult(1/k),d.state.vel.clamp(g.options.minVel,g.options.maxVel),d.isGrabbed=!1,b.body=d,delete d.isGrabbed),g._world.emit("interact:release",b),delete g.bodyData[e]}},connect:function(b){b.on("integrate:positions",this.behave,this),a.PointerEvent?(this.el.addEventListener("pointerdown",this.grab),a.addEventListener("pointermove",this.move),a.addEventListener("pointerup",this.release)):(this.el.addEventListener("mousedown",this.grab),this.el.addEventListener("touchstart",this.grab),a.addEventListener("mousemove",this.move),a.addEventListener("touchmove",this.move),a.addEventListener("mouseup",this.release),a.addEventListener("touchend",this.release))},disconnect:function(b){b.off("integrate:positions",this.behave,this),a.PointerEvent?(this.el.removeEventListener("pointerdown",this.grab),a.removeEventListener("pointermove",this.move),a.removeEventListener("pointerup",this.release)):(this.el.removeEventListener("mousedown",this.grab),this.el.removeEventListener("touchstart",this.grab),a.removeEventListener("mousemove",this.move),a.removeEventListener("touchmove",this.move),a.removeEventListener("mouseup",this.release),a.removeEventListener("touchend",this.release))},behave:function(a){var b,c,d,e=this,f=Math.max(a.dt,e.options.moveThrottle);for(var g in e.bodyData)d=e.bodyData[g],c=d.body,b=c.state,b.vel.clone(d.pos).vsub(d.offset).vsub(b.pos).mult(1/f)}}}),c.behavior("newtonian",function(a){var b={strength:1,max:!1,min:!1};return{init:function(c){var d=this;a.init.call(this),this.options.defaults(b),this.options.onChange(function(a){d._maxDistSq=a.max===!1?1/0:a.max*a.max,d._minDistSq=a.min?a.min*a.min:100*a.strength}),this.options(c)},calcPotential:function(a,b,d){var e,f,g,h=this.options.strength,i=this._minDistSq,j=this._maxDistSq;return g=d||new c.vector,g.clone(b).vsub(a),e=g.normSq(),e>i&&e<j?(f=h/e,g.normalize().mult(f)):g.zero()},behave:function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o=this.getTargets(),p=c.scratchpad(),q=p.vector(),r=p.vector(),s=p.vector();for(i=0,l=o.length;i<l;i++)for(b=o[i],h=i+1;h<l;h++){if(d=o[h],"compound"===b.name?e=b:"compound"===d.name&&(e=d,d=b),e)if("compound"===d.name)for(j=0,m=e.children.length;j<m;j++)for(f=e.children[j],e.toWorldCoords(r.clone(f.state.pos).vadd(e.offset)),k=0,n=d.children.length;k<n;k++)g=d.children[k],d.toWorldCoords(s.clone(g.state.pos).vadd(d.offset)),this.calcPotential(r,s,q),e.accelerate(q.mult(g.mass)),d.accelerate(q.mult(f.mass/g.mass).negate());else for(j=0,m=e.children.length;j<m;j++)f=e.children[j],e.toWorldCoords(r.clone(f.state.pos).vadd(e.offset)),this.calcPotential(r,d.state.pos,q),e.accelerate(q.mult(d.mass)),d.accelerate(q.mult(f.mass/d.mass).negate());else this.calcPotential(b.state.pos,d.state.pos,q),b.accelerate(q.mult(d.mass)),d.accelerate(q.mult(b.mass/d.mass).negate());e=null}p.done()}}}),c.behavior("sweep-prune",function(a){var b=1,d=function(){return b++},e={x:0,y:1},f=2,g=c.util.pairHash;return{init:function(b){a.init.call(this),this.options.defaults({channel:"collisions:candidates"}),this.options(b),this.encounters=[],this.candidates=[],this.clear()},clear:function(){this.tracked=[],this.pairs=[],this.intervalLists=[];for(var a=0;a<f;++a)this.intervalLists[a]=[]},connect:function(a){a.on("add:body",this.trackBody,this),a.on("remove:body",this.untrackBody,this),a.on("integrate:positions",this.sweep,this,1);for(var b=a.getBodies(),c=0,d=b.length;c<d;++c)this.trackBody({body:b[c]})},disconnect:function(a){a.off("add:body",this.trackBody,this),a.off("remove:body",this.untrackBody,this),a.off("integrate:positions",this.sweep,this,1),this.clear()},broadPhase:function(){return this.updateIntervals(),this.sortIntervalLists(),this._world&&this._world.emit("sweep-prune:intervals",this.intervalLists),this.checkOverlaps()},sortIntervalLists:function(){for(var a,b,c,d,e,g,h,i,j,k=0;k<f;++k)for(a=this.intervalLists[k],c=0,b=a.length,j=k;++c<b;){for(e=a[c],g=e.val.get(j),d=c,h=a[d-1],i=h&&h.val.get(j);d>0&&(i>g||i===g&&h.type&&!e.type);)a[d]=h,d--,h=a[d-1],i=h&&h.val.get(j);a[d]=e}},getPair:function(a,b,c){var d=g(a.id,b.id);if(d===!1)return null;var e=this.pairs[d];if(!e){if(!c)return null;e=this.pairs[d]={bodyA:a.body,bodyB:b.body,flag:1}}return c&&(e.flag=1),e},checkOverlaps:function(){var a,b,d,g,h,i,j,k,l,m=1<<e.z+1<<e.y+1<<e.x+1,n=this.encounters,o=0,p=this.candidates;c.util.clearArray(n),c.util.clearArray(p);for(var q=0;q<f;++q)for(a=0===q,h=this.intervalLists[q],j=0,i=h.length;j<i;j++)if(g=h[j],b=g.tracker,g.type)for(k=o,k=o-1;k>=0;k--)d=n[k],d===b?(k<o-1?n[k]=n.pop():n.pop(),o--):(l=this.getPair(b,d,a),l&&l.flag<m&&(l.flag=l.flag<<q+1,l.flag===m&&p.push(l)));else o=n.push(b);return p},updateIntervals:function(){for(var a,b,c,d=this.tracked,e=d.length;--e>=0;)a=d[e],b=a.interval,c=a.body.aabb(),b.min.val.clone(c).sub(c.hw,c.hh),b.max.val.clone(c).add(c.hw,c.hh)},trackBody:function(a){var b=a.body,e={id:d(),body:b},g={min:{type:!1,val:new c.vector,tracker:e},max:{type:!0,val:new c.vector,tracker:e}};e.interval=g,this.tracked.push(e);for(var h=0;h<f;++h)this.intervalLists[h].push(g.min,g.max)},untrackBody:function(a){for(var b,c,d,e,g=a.body,h=this.tracked,i=0,j=h.length;i<j;++i)if(d=h[i],d.body===g){h.splice(i,1);for(var k=0;k<f;++k){e=0,b=this.intervalLists[k];for(var l=0,m=b.length;l<m;++l)if(c=b[l],c===d.interval.min||c===d.interval.max){if(b.splice(l,1),l--,j--,e>0)break;e++}}break}},sweep:function(a){var b,c=this;b=c.broadPhase(),b.length&&this._world.emit(this.options.channel,{candidates:b})}}}),c.behavior("verlet-constraints",function(a){var b=2*Math.PI,d={iterations:2};return{init:function(b){a.init.call(this),this.options.defaults(d),this.options(b),this._distanceConstraints=[],this._angleConstraints=[]},connect:function(a){var b=a.integrator();if(b&&b.name.indexOf("verlet")<0)throw'The rigid constraint manager needs a world with a "verlet" compatible integrator.';a.on("integrate:positions",this.resolve,this)},disconnect:function(a){a.off("integrate:positions",this.resolve,this)},drop:function(){return this._distanceConstraints=[],this._angleConstraints=[],this},distanceConstraint:function(a,b,d,e){var f;return!(!a||!b)&&(f={id:c.util.uniqueId("dis-constraint"),type:"dis",bodyA:a,bodyB:b,stiffness:d||.5,targetLength:e||b.state.pos.dist(a.state.pos)},f.targetLengthSq=f.targetLength*f.targetLength,this._distanceConstraints.push(f),f)},angleConstraint:function(a,b,d,e,f){var g;return!(!a||!b)&&(g={id:c.util.uniqueId("ang-constraint"),type:"ang",bodyA:a,bodyB:b,bodyC:d,stiffness:e||.5,targetAngle:f||b.state.pos.angle2(a.state.pos,d.state.pos)},this._angleConstraints.push(g),g)},remove:function(a){var b,d,e,f,g;if(e=c.util.isObject(a),d=e?a.type:a.substr(0,3),b="ang"===d?this._angleConstraints:this._distanceConstraints,e){for(f=0,g=b.length;f<g;++f)if(b[f]===a)return b.splice(f,1),this}else for(f=0,g=b.length;f<g;++f)if(b[f].id===a)return b.splice(f,1),this;return this},resolveAngleConstraints:function(a){for(var d,e,f,g,h=this._angleConstraints,i=c.scratchpad(),j=i.transform(),k=0,l=h.length;k<l;++k)d=h[k],e=d.bodyB.state.pos.angle2(d.bodyA.state.pos,d.bodyC.state.pos),f=e-d.targetAngle,f&&(f<=-Math.PI?f+=b:f>=Math.PI&&(f-=b),j.setTranslation(d.bodyB.state.pos),f*=-a*d.stiffness,"dynamic"===d.bodyA.treatment&&"dynamic"===d.bodyB.treatment&&"dynamic"===d.bodyC.treatment&&(g=1/(d.bodyA.mass+d.bodyB.mass+d.bodyC.mass)),"dynamic"===d.bodyA.treatment&&(e="dynamic"===d.bodyB.treatment&&"dynamic"===d.bodyC.treatment?f*(d.bodyB.mass+d.bodyC.mass)*g:"dynamic"!==d.bodyB.treatment?f*d.bodyC.mass/(d.bodyC.mass+d.bodyA.mass):f*d.bodyB.mass/(d.bodyB.mass+d.bodyA.mass),j.setRotation(e),d.bodyA.state.pos.translateInv(j),d.bodyA.state.pos.rotate(j),d.bodyA.state.pos.translate(j)),"dynamic"===d.bodyC.treatment&&(e="dynamic"===d.bodyA.treatment&&"dynamic"===d.bodyB.treatment?-f*(d.bodyB.mass+d.bodyA.mass)*g:"dynamic"!==d.bodyB.treatment?-f*d.bodyA.mass/(d.bodyC.mass+d.bodyA.mass):-f*d.bodyB.mass/(d.bodyB.mass+d.bodyC.mass),j.setRotation(e),d.bodyC.state.pos.translateInv(j),d.bodyC.state.pos.rotate(j),d.bodyC.state.pos.translate(j)),"dynamic"===d.bodyB.treatment&&(e="dynamic"===d.bodyA.treatment&&"dynamic"===d.bodyC.treatment?f*(d.bodyA.mass+d.bodyC.mass)*g:"dynamic"!==d.bodyA.treatment?f*d.bodyC.mass/(d.bodyC.mass+d.bodyB.mass):f*d.bodyA.mass/(d.bodyA.mass+d.bodyC.mass),j.setRotation(e).setTranslation(d.bodyA.state.pos),d.bodyB.state.pos.translateInv(j),d.bodyB.state.pos.rotate(j),d.bodyB.state.pos.translate(j),j.setTranslation(d.bodyC.state.pos),d.bodyB.state.pos.translateInv(j),d.bodyB.state.pos.rotateInv(j),d.bodyB.state.pos.translate(j)),d.bodyA.sleepCheck(),d.bodyB.sleepCheck(),d.bodyC.sleepCheck());i.done()},resolveDistanceConstraints:function(a){for(var b,d,e,f,g=this._distanceConstraints,h=c.scratchpad(),i=h.vector(),j=0,k=g.length;j<k;++j)b=g[j],i.clone(b.bodyB.state.pos).vsub(b.bodyA.state.pos),d=i.normSq()||1e-4*Math.random(),e=a*b.stiffness*(d-b.targetLengthSq)/d,i.mult(e),f="dynamic"!==b.bodyA.treatment||"dynamic"!==b.bodyB.treatment?1:b.bodyB.mass/(b.bodyA.mass+b.bodyB.mass),"dynamic"===b.bodyA.treatment&&("dynamic"===b.bodyB.treatment&&i.mult(f),b.bodyA.state.pos.vadd(i),"dynamic"===b.bodyB.treatment&&i.mult(1/f)),"dynamic"===b.bodyB.treatment&&("dynamic"===b.bodyA.treatment&&i.mult(1-f),b.bodyB.state.pos.vsub(i)),b.bodyA.sleepCheck(),b.bodyB.sleepCheck();h.done()},shuffleConstraints:function(){this._distanceConstraints=c.util.shuffle(this._distanceConstraints),this._angleConstraints=c.util.shuffle(this._angleConstraints)},resolve:function(){for(var a=this.options.iterations,b=1/a,c=0;c<a;c++)this.resolveDistanceConstraints(b),this.resolveAngleConstraints(b)},getConstraints:function(){return{distanceConstraints:[].concat(this._distanceConstraints),angleConstraints:[].concat(this._angleConstraints)}}}}),c.integrator("improved-euler",function(a){return{init:function(b){a.init.call(this,b)},integrateVelocities:function(a,b){for(var c,d=1-this.options.drag,e=null,f=0,g=a.length;f<g;++f)e=a[f],c=e.state,"static"===e.treatment||e.sleep(b)?(c.vel.zero(),c.acc.zero(),c.angular.vel=0,c.angular.acc=0):(c.old.vel.clone(c.vel),c.old.acc.clone(c.acc),c.vel.vadd(c.acc.mult(b)),d&&c.vel.mult(d),c.acc.zero(),c.old.angular.vel=c.angular.vel,c.angular.vel+=c.angular.acc*b,c.angular.acc=0)},integratePositions:function(a,b){for(var d,e=.5*b*b,f=null,g=c.scratchpad(),h=g.vector(),i=0,j=a.length;i<j;++i)f=a[i],d=f.state,"static"===f.treatment||f.sleep()||(d.old.pos.clone(d.pos),h.clone(d.old.vel),d.pos.vadd(h.mult(b)).vadd(d.old.acc.mult(e)),d.old.acc.zero(),d.old.angular.pos=d.angular.pos,d.angular.pos+=d.old.angular.vel*b+d.old.angular.acc*e,d.old.angular.acc=0);g.done()}}}),c.integrator("velocity-verlet-alt",function(a){return c.body.mixin({started:function(a){return void 0!==a&&(this._started=!0),!!this._started}}),{init:function(b){a.init.call(this,b)},integrateVelocities:function(a,b){for(var c,d=1-this.options.drag,e=null,f=0,g=a.length;f<g;++f)e=a[f],c=e.state,"static"!==e.treatment?(e.started()||(c.old.acc.clone(c.acc),c.old.acc.mult(b),c.old.vel.clone(c.vel).vsub(c.old.acc),c.old.acc.mult(1/b)),d&&c.vel.mult(d),c.vel.vadd(c.old.acc.vadd(c.acc).mult(.5*b)),e.started()||(c.old.angular.acc=c.angular.acc,c.old.angular.vel=c.angular.vel-c.old.angular.acc*b),c.angular.vel+=.5*(c.angular.acc+c.old.angular.acc)*b,c.angular.acc=0,e.started(!0)):(c.vel.zero(),c.acc.zero(),c.angular.vel=0,c.angular.acc=0)},integratePositions:function(a,b){for(var c,d=b*b,e=null,f=0,g=a.length;f<g;++f)e=a[f],
c=e.state,"static"!==e.treatment&&(c.old.pos.clone(c.pos),c.old.vel.mult(b),c.old.acc.mult(.5*d),c.pos.vadd(c.old.vel).vadd(c.old.acc),c.old.vel.clone(c.vel),c.old.acc.clone(c.acc),c.acc.zero(),c.old.angular.pos=c.angular.pos,c.angular.pos+=c.angular.vel*b+.5*c.old.angular.acc*d,c.old.angular.vel=c.angular.vel,c.old.angular.acc=c.angular.acc,c.angular.acc=0)}}}),c.integrator("velocity-verlet",function(a){return c.body.mixin({started:function(a){return void 0!==a&&(this._started=!0),!!this._started}}),{init:function(b){a.init.call(this,b)},integrate:function(a,b){var c=this._world;return this.integratePositions(a,b),c&&c.emit("integrate:positions",{bodies:a,dt:b}),this.integrateVelocities(a,b),c&&c.emit("integrate:velocities",{bodies:a,dt:b}),this},integrateVelocities:function(a,b){for(var c,d=1-this.options.drag,e=null,f=0,g=a.length;f<g;++f)e=a[f],c=e.state,"static"===e.treatment||e.sleep()?(c.vel.zero(),c.acc.zero(),c.angular.vel=0,c.angular.acc=0):(d&&c.vel.mult(d),c.old.vel.clone(c.vel),c.vel.vadd(c.old.acc.vadd(c.acc).mult(.5*b)),c.old.acc.clone(c.acc),c.acc.zero(),c.old.angular.vel=c.angular.vel,c.old.angular.acc=c.angular.acc,c.angular.vel+=.5*(c.angular.acc+c.old.angular.acc)*b,c.angular.acc=0,e.started(!0))},integratePositions:function(a,b){for(var c,d=b*b,e=null,f=0,g=a.length;f<g;++f)e=a[f],c=e.state,"static"===e.treatment||e.sleep(b)||(e.started()||(c.old.acc.clone(c.acc),c.old.acc.mult(b),c.old.vel.clone(c.vel).vsub(c.old.acc),c.old.acc.mult(1/b)),c.old.pos.clone(c.pos),c.old.vel.mult(b),c.old.acc.mult(.5*d),c.pos.vadd(c.old.vel).vadd(c.old.acc),c.old.vel.mult(1/b),c.old.acc.mult(2/d),e.started()||(c.old.angular.acc=c.angular.acc,c.old.angular.vel=c.angular.vel-c.old.angular.acc*b),c.old.angular.pos=c.angular.pos,c.angular.pos+=c.angular.vel*b+.5*c.old.angular.acc*d)}}}),c.renderer("canvas",function(a){if(!b)return{};var d=2*Math.PI,e=function(a,c){var d=b.createElement(a||"div");return c&&(d.innerHTML=c),d},f={white:"#fff",violet:"#542437",blue:"#53777A"},g={metaEl:null,styles:{point:f.blue,circle:{strokeStyle:f.blue,lineWidth:1,fillStyle:f.blue,angleIndicator:f.white},rectangle:{strokeStyle:f.violet,lineWidth:1,fillStyle:f.violet,angleIndicator:f.white},"convex-polygon":{strokeStyle:f.violet,lineWidth:1,fillStyle:f.violet,angleIndicator:f.white}},offset:{x:0,y:0}};return{init:function(d){var f=this;if(a.init.call(this,d),this.options.defaults(g,!0),this.options.onChange(function(){f.options.offset=new c.vector(f.options.offset)}),this.options(d,!0),this.hiddenCanvas=b.createElement("canvas"),this.hiddenCanvas.width=this.hiddenCanvas.height=100,!this.hiddenCanvas.getContext)throw"Canvas not supported";this.hiddenCtx=this.hiddenCanvas.getContext("2d");var h=this.el;if("CANVAS"!==h.nodeName.toUpperCase()&&(h=b.createElement("canvas"),this.el.appendChild(h),"string"==typeof this.options.el&&this.el===b.body&&(h.id=this.options.el),this.el=h),this.container=this.el.parentNode,this.ctx=h.getContext("2d"),this.els={},this.options.meta){var i=this.options.metaEl||e();i.className="pjs-meta",this.els.fps=e("span"),this.els.ipf=e("span"),i.appendChild(e("span","fps: ")),i.appendChild(this.els.fps),i.appendChild(e("br")),i.appendChild(e("span","ipf: ")),i.appendChild(this.els.ipf),h.parentNode.insertBefore(i,h)}this._layers={},this.addLayer("main",this.el),this.options.autoResize?this.resize():this.resize(this.options.width,this.options.height)},layer:function(a){return a in this._layers?this._layers[a]:null},addLayer:function(a,d,e){var f=this,g=[],h=c.util.extend({},this.options.styles),i={id:a,el:d||b.createElement("canvas"),options:c.util.options({width:this.el.width,height:this.el.height,manual:!1,autoResize:!0,follow:null,offset:null,scale:1,zIndex:1})(e)};if(a in this._layers)throw'Layer "'+a+'" already added.';return this.el.parentNode.insertBefore(i.el,this.el),i.el.style.position="absolute",i.el.style.zIndex=i.options.zIndex,i.el.className+=" pjs-layer-"+i.id,i.ctx=i.el.getContext("2d"),i.ctx.scale(1,1),i.el.width=i.options.width,i.el.height=i.options.height,i.bodies=g,i.reset=function(a){return g=a||[],i},i.addToStack=function(a){return c.util.isArray(a)?g.push.apply(g,a):g.push(a),i},i.removeFromStack=function(a){var b,d;if(c.util.isArray(a))for(b=0,d=a.length;b<d;++b)i.removeFromStack(a[b]);else b=c.util.indexOf(g,a),b>-1&&g.splice(b,1);return i},i.render=function(a){var b,d,e,j=c.scratchpad(),k=j.vector().set(0,0),l=i.options.scale,m=g.length,n=f._interpolateTime,o=m||"main"!==i.id?g:f._world._bodies;if(i.options.manual)return j.done(),i;for(i.options.offset&&("center"===i.options.offset?k.add(.5*i.el.width,.5*i.el.height).mult(1/l):k.vadd(i.options.offset).mult(1/l)),i.options.follow&&(k.vsub(i.options.follow.state.pos),k.sub(i.options.follow.state.vel.get(0)*n,i.options.follow.state.vel.get(1)*n)),a!==!1&&i.ctx.clearRect(0,0,i.el.width,i.el.height),1!==l&&(i.ctx.save(),i.ctx.scale(l,l)),e=0,m=o.length;e<m;++e)b=o[e],b.hidden||(d=b.view||(b.view=f.createView(b.geometry,b.styles||h[b.geometry.name])),f.drawBody(b,b.view,i.ctx,k));return 1!==l&&i.ctx.restore(),j.done(),i},this._layers[a]=i,i},removeLayer:function(a){var b=a.id?a.id:a,c=this._layers[b].el;return c!==this.el&&c.parentNode.removeChild(c),delete this._layers[b],this},resize:function(b,c){var d;a.resize.call(this,b,c);for(var e in this._layers)d=this._layers[e],d.options.autoResize&&(d.el.width=this.width,d.el.height=this.height);return this},setStyle:function(a,b){b=b||this.ctx,c.util.isObject(a)?(a.strokeStyle=a.lineWidth?a.strokeStyle:"rgba(0,0,0,0)",c.util.extend(b,a)):(b.fillStyle=b.strokeStyle=a,b.lineWidth=1)},drawCircle:function(a,b,c,e,f){f=f||this.ctx,f.beginPath(),this.setStyle(e,f),f.arc(a,b,c,0,d,!1),f.closePath(),f.stroke(),f.fill()},drawPolygon:function(a,b,c){var d=a[0],e=d.x,f=d.y,g=a.length;c=c||this.ctx,c.beginPath(),this.setStyle(b,c),c.moveTo(e,f);for(var h=1;h<g;++h)d=a[h],e=d.x,f=d.y,c.lineTo(e,f);g>2&&c.closePath(),c.stroke(),c.fill()},drawRect:function(a,b,c,d,e,f){var g=.5*c,h=.5*d;f=f||this.ctx,this.setStyle(e,f),f.beginPath(),f.rect(a-g,b-h,c,d),f.closePath(),f.stroke(),f.fill()},drawLine:function(a,b,c,d){var e=a.x,f=a.y;d=d||this.ctx,d.beginPath(),this.setStyle(c,d),d.moveTo(e,f),e=b.x,f=b.y,d.lineTo(e,f),d.stroke(),d.fill()},draw:function(a,b,c,d){var e=a.name,f=+(d&&d.x),g=+(d&&d.y),h=a.aabb().hw;if(c=c||this.ctx,b=b||this.options.styles[e]||this.options.styles.circle||{},c.save(),c.translate(f,g),"circle"===e)this.drawCircle(0,0,a.radius,b,c);else if("convex-polygon"===e)this.drawPolygon(a.vertices,b,c);else if("rectangle"===e)this.drawRect(0,0,a.width,a.height,b,c);else if("compound"===e)for(var i,j=0,k=a.children.length;j<k;j++)i=a.children[j],c.translate(i.pos.x,i.pos.y),c.rotate(i.angle),this.draw(i.g,b,c),c.rotate(-i.angle),c.translate(-i.pos.x,-i.pos.y);else this.drawCircle(0,0,1,b,c);return"compound"!==e&&b.angleIndicator&&(c.beginPath(),this.setStyle(b.angleIndicator,c),c.moveTo(0,0),c.lineTo(h,0),c.closePath(),c.stroke()),c.restore(),this},createView:function(a,b){var c,d=a.aabb(),e=d.hw+Math.abs(d.x),f=d.hh+Math.abs(d.y),g={x:e+1,y:f+1},h=this.hiddenCtx,i=this.hiddenCanvas;return b=b||this.options.styles[name]||this.options.styles.circle||{},b.src?(c=new Image,c.src=b.src,b.width&&(c.width=b.width),b.height&&(c.height=b.height),c):(g.x+=0|b.lineWidth,g.y+=0|b.lineWidth,i.width=2*e+2+(2*b.lineWidth|0),i.height=2*f+2+(2*b.lineWidth|0),this.draw(a,b,h,g),c=new Image(i.width,i.height),c.src=i.toDataURL("image/png"),c)},drawMeta:function(a){this.els.fps.innerHTML=a.fps.toFixed(2),this.els.ipf.innerHTML=a.ipf},drawBody:function(a,b,c,d){var e,f,g,h=a.state.pos,i=a.offset,j=a.state.vel,k=this._interpolateTime||0;d=d||this.options.offset,c=c||this.ctx,e=h._[0]+d.x+j._[0]*k,f=h._[1]+d.y+j._[1]*k,g=a.state.angular.pos+a.state.angular.vel*k,c.save(),c.translate(e,f),c.rotate(g),c.translate(i._[0],i._[1]),c.drawImage(b,-b.width/2,-b.height/2,b.width,b.height),c.restore()},render:function(a,b){this._world.emit("beforeRender",{renderer:this,meta:b}),this.options.meta&&this.drawMeta(b),this._interpolateTime=b.interpolateTime;for(var c in this._layers)this._layers[c].render();return this}}}),c.renderer("dom",function(a){if(!b)return{};var c={},d=b.createElement("div"),e=function(a){return a.replace(/(?:^|\s)\w/g,function(a){return a.toUpperCase()})},f=function(a){if(c[a])return c[a];for(var b,f=["Webkit","Moz","Ms","O"],g=0,h=f.length;g<h;++g)if(b=f[g]+e(a),b in d.style)return c[a]=b;return b in d.style&&(c[a]=a)},g="pjs-",h="px",i=f("transform"),j=f("borderRadius"),k=function(a,c){var d=b.createElement(a||"div");return c&&(d.innerHTML=c),d};return{init:function(b){a.init.call(this,b);var c=this.el;if(c.style.position="relative",c.style.overflow="hidden",c.style[i]="translateZ(0)",c.style.width=this.options.width+h,c.style.height=this.options.height+h,this.els={},b.meta){var d=k();d.className="pjs-meta",this.els.fps=k("span"),this.els.ipf=k("span"),d.appendChild(k("span","fps: ")),d.appendChild(this.els.fps),d.appendChild(k("br")),d.appendChild(k("span","ipf: ")),d.appendChild(this.els.ipf),c.appendChild(d)}this.options.autoResize?this.resize():this.resize(this.options.width,this.options.height)},resize:function(b,c){a.resize.call(this,b,c),this.el.style.width=this.width+h,this.el.style.height=this.height+h},pointProperties:function(a,b){a.style.width="2px",a.style.height="2px",a.style.marginLeft="-1px",a.style.marginTop="-1px",a.style[j]="50%"},circleProperties:function(a,b){var c=b.aabb();a.style.width=2*c.hw+h,a.style.height=2*c.hh+h,a.style.marginLeft=-c.hw+h,a.style.marginTop=-c.hh+h,a.style[j]="50%"},rectangleProperties:function(a,b){var c=b.aabb();a.style.width=2*c.hw+h,a.style.height=2*c.hh+h,a.style.marginLeft=-c.hw+h,a.style.marginTop=-c.hh+h},createView:function(a){var b,c=k(),d=a.name+"Properties";if(c.className=g+a.name,c.style.position="absolute",c.style.top="0px",c.style.left="0px","compound"===a.name)for(var e,f=0,h=a.children.length;f<h;f++)e=a.children[f],b=k(),b.className=g+a.name+" "+g+"child",b.style.position="absolute",b.style.top="0px",b.style.left="0px",this[e.g.name+"Properties"]&&this[e.g.name+"Properties"](b,e.g),b.style[i]="translate("+e.pos._[0]+"px,"+e.pos._[1]+"px) rotate("+e.angle+"rad)",c.appendChild(b);else this[d]&&this[d](c,a);return this.el.appendChild(c),c},connect:function(a){a.on("add:body",this.attach,this),a.on("remove:body",this.detach,this)},disconnect:function(a){a.off("add:body",this.attach,this),a.off("remove:body",this.detach,this)},detach:function(a){var b=a.nodeType&&a||a.body&&a.body.view,c=b&&b.parentNode;return b&&c&&c.removeChild(b),this},attach:function(a){var b=a.nodeType&&a||a.body&&a.body.view;return b&&this.el.appendChild(b),this},drawMeta:function(a){this.els.fps.innerHTML=a.fps.toFixed(2),this.els.ipf.innerHTML=a.ipf},drawBody:function(a,b){var c,d,e,f=a.state.pos,g=a.state.vel,h=a.offset,j=this._interpolateTime;c=f._[0]+g._[0]*j,d=f._[1]+g._[1]*j,e=a.state.angular.pos+a.state.angular.vel*j,b.style[i]="translate("+c+"px,"+d+"px) rotate("+e+"rad) translate("+h._[0]+"px,"+h._[1]+"px)"}}}),c.renderer("pixi",function(d){if(!b)return{};var e=(2*Math.PI,{white:"0xFFFFFF",violet:"0x542437",blue:"0x53777A"}),f={font:"18px monospace",fill:"black",align:"left"},g={metaEl:null,offset:{x:0,y:0},styles:{color:!1,point:e.blue,circle:{strokeStyle:e.blue,lineWidth:1,fillStyle:e.blue,angleIndicator:e.white,fillAlpha:1,strokeAlpha:1,alpha:1},rectangle:{strokeStyle:e.violet,lineWidth:1,fillStyle:e.violet,angleIndicator:e.white,fillAlpha:1,strokeAlpha:1,alpha:1},"convex-polygon":{strokeStyle:e.violet,lineWidth:1,fillStyle:e.violet,angleIndicator:e.white,fillAlpha:1,strokeAlpha:1,alpha:1}}};return{init:function(e){var f,h,i=this;if("undefined"==typeof PIXI)throw"PIXI not present - cannot continue";d.init.call(this,e),this.options.defaults(g,!0),this.options.onChange(function(){i.options.offset=new c.vector(i.options.offset)}),this.options(e,!0),h=!this.options.styles.color||"transparent"===this.options.styles.color,this.stage=new PIXI.Stage(this.options.styles.color),this.meta={},f=this.el&&"CANVAS"===this.el.nodeName?f:null,this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height,{view:f,transparent:h,resolution:a.devicePixelRatio||1}),f||(this.el=this.el||b.body,this.el.appendChild(this.renderer.view)),this.options.autoResize?this.resize():this.resize(this.options.width,this.options.height)},resize:function(a,b){d.resize.call(this,a,b),this.renderer.resize(this.width,this.height)},connect:function(a){a.on("add:body",this.attach,this),a.on("remove:body",this.detach,this)},disconnect:function(a){a.off("add:body",this.attach,this),a.off("remove:body",this.detach,this)},detach:function(a){var b=a instanceof PIXI.Graphics&&a||a.body&&a.body.view;return b&&this.stage.removeChild(b),this},attach:function(a){var b=a instanceof PIXI.Graphics&&a||a.body&&a.body.view;return b&&this.stage.addChild(b),this},loadSpriteSheets:function(a,b){if(!c.util.isArray(a))throw"Spritesheets must be defined in arrays";var d=this,e=new PIXI.AssetLoader(a);return e.load(),e.on("onComplete",function(a){d.assetsLoaded=!0,b()}),d},drawBody:function(a,b){var c,d,e,f=a.state.pos,g=a.state.vel,h=a.offset,i=this._interpolateTime||0;c=f._[0]+g._[0]*i,d=f._[1]+g._[1]*i,e=a.state.angular.pos+a.state.angular.vel*i,b.position.set(c,d),b.pivot.set(-h._[0],-h._[1]),b.rotation=e},render:function(a,b){d.render.call(this,a,b),this.renderer.render(this.stage)},setStyles:function(a,b){return c.util.isObject(b)?(b.fillStyle&&"transparent"!==b.fillStyle?(a.beginFill(b.fillStyle),a.fillAlpha=void 0!==b.fillAlpha?b.fillAlpha:1):(a.beginFill(),a.fillAlpha=0),a.lineStyle(b.lineWidth||0,b.strokeStyle,void 0!==b.strokeAlpha?b.strokeAlpha:1),a.alpha=void 0!==b.alpha?b.alpha:1):(b&&"transparent"!==b?a.beginFill(b):(a.beginFill(),a.fillAlpha=0),a.lineStyle(0)),a},createCircle:function(a,b,c,d){var e=new PIXI.Graphics;return this.setStyles(e,d),e.drawCircle(a,b,c),e.endFill(),e},createRect:function(a,b,c,d,e){var f=new PIXI.Graphics;return this.setStyles(f,e),f.drawRect(a,b,c,d),f.endFill(),f},createPolygon:function(a,b){var c=a[0],d=c.x,e=c.y,f=a.length,g={x:d,y:e},h=new PIXI.Graphics;this.setStyles(h,b),h.moveTo(d,e);for(var i=1;i<f;++i)c=a[i],d=c.x,e=c.y,h.lineTo(d,e);return f>2&&h.lineTo(g.x,g.y),h.endFill(),h},createLine:function(a,b,c){var d=a.x,e=a.y,f=new PIXI.Graphics;return this.setStyles(f,c),f.moveTo(d,e),d=b.x,e=b.y,f.lineTo(d,e),f.endFill(),f},createView:function(a,b,c){var d=null,e=a.aabb(),f=e.hw+Math.abs(e.x),g=(e.hh+Math.abs(e.y),a.name);if(c=c||this.stage,b=b||this.options.styles[g]||this.options.styles.circle||{},b.src)return d=PIXI.Sprite.fromImage(b.src),d.anchor.set(.5,.5),b.anchor&&(d.anchor.x=b.anchor.x,d.anchor.y=b.anchor.y),b.width&&(d.width=b.width),b.height&&(d.height=b.height),c.addChild(d),d;if("circle"===g)d=this.createCircle(0,0,a.radius,b);else if("convex-polygon"===g)d=this.createPolygon(a.vertices,b);else if("rectangle"===g)d=this.createRect(-a.width/2,-a.height/2,a.width,a.height,b);else if("compound"===g){d=new PIXI.Graphics;for(var h,i,j=0,k=a.children.length;j<k;j++)h=a.children[j],i=this.createView(h.g,b,d),i.position.set(h.pos.x,h.pos.y),i.rotation=h.angle}else d=this.createCircle(0,0,1,b);return"compound"!==g&&b.angleIndicator&&"transparent"!==b.angleIndicator&&(d.lineStyle(b.lineWidth,b.angleIndicator),d.moveTo(0,0),d.lineTo(f,0)),"compound"!==g&&(d.cacheAsBitmap=!0),c.addChild(d),d},drawMeta:function(a){this.meta.loaded?(this.meta.fps.setText("FPS: "+a.fps.toFixed(2)),this.meta.ipf.setText("IPF: "+a.ipf)):(this.meta.fps=new PIXI.Text("FPS: "+a.fps.toFixed(2),f),this.meta.fps.position.x=15,this.meta.fps.position.y=5,this.meta.ipf=new PIXI.Text("IPF: "+a.ipf,f),this.meta.ipf.position.x=15,this.meta.ipf.position.y=30,this.stage.addChild(this.meta.fps),this.stage.addChild(this.meta.ipf),this.meta.loaded=!0)},createDisplay:function(a,b){var c=null,d=null;switch(a){case"sprite":return d=PIXI.Texture.fromImage(b.texture),c=new PIXI.Sprite(d),b.anchor&&(c.anchor.x=b.anchor.x,c.anchor.y=b.anchor.y),b.container?b.container.addChild(c):this.stage.addChild(c),c;case"movieclip":if(!this.assetsLoaded)throw"No assets have been loaded. Use loadSpritesheet() first";var e=[],f=0;for(f;f<b.frames.length;f++)d=PIXI.Texture.fromFrame(b.frames[f]),e.push(d);return c=new PIXI.MovieClip(e),b.anchor&&(c.anchor.x=b.anchor.x,c.anchor.y=b.anchor.y),b.container?b.container.addChild(c):this.stage.addChild(c),c;default:throw"Invalid PIXI.DisplayObject passed"}},centerAnchor:function(a){null!==a&&(a.anchor.x=.5,a.anchor.y=.5)}}}),c});